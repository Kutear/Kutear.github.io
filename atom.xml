<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://www.kutear.com</id>
    <title>KuTearæŠ€æœ¯ä¹‹æ—…</title>
    <updated>2024-03-12T13:03:34.990Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://www.kutear.com"/>
    <link rel="self" href="https://www.kutear.com/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://www.kutear.com/images/avatar.png</logo>
    <icon>https://www.kutear.com/favicon.ico</icon>
    <rights>All rights reserved 2024, KuTearæŠ€æœ¯ä¹‹æ—…</rights>
    <entry>
        <title type="html"><![CDATA[Java æšä¸¾]]></title>
        <id>https://www.kutear.com/post/java-mei-ju/</id>
        <link href="https://www.kutear.com/post/java-mei-ju/">
        </link>
        <updated>2024-03-12T12:51:05.000Z</updated>
        <content type="html"><![CDATA[<ol>
<li>é»˜è®¤æšä¸¾ç»§æ‰¿è‡³Enumç±»,ç”±äº<code>Java</code>çš„å•ä¸€ç»§æ‰¿æœºåˆ¶,æ‰€ä»¥ä¸èƒ½åœ¨ç»§æ‰¿è‡³åˆ«çš„ç±».</li>
<li>æšä¸¾ä¸­çš„å…ƒç´ å®è´¨ä¸ºç±»çš„ç±»éƒ¨é™æ€å¸¸é‡åŸŸ. <code>java public class EnumTest { enum Test { TEST_1(&quot;1&quot;), TEST_2(&quot;2&quot;); private String descript; Test(String descript) { this.descript = descript; } } }</code> è¯¥æšä¸¾é€šè¿‡åç¼–è¯‘æŸ¥çœ‹å…¶å†…éƒ¨(<code>javap EnumTest$Test.class</code>),å¦å¤–,æšä¸¾ç±»æ˜¯<code>final</code>,ä¸ä¼šæœ‰å­ç±» <code>java Compiled from &quot;EnumTest.java&quot; final class EnumTest$Test extends java.lang.Enum&lt;EnumTest$Test&gt; { public static final EnumTest$Test TEST_1; public static final EnumTest$Test TEST_2; public static EnumTest$Test[] values(); public static EnumTest$Test valueOf(java.lang.String); static {}; }</code></li>
<li>å¯¹äºå…¶æ„é€ å‡½æ•°,ç”±äºä¸å…è®¸ç”¨æˆ·è‡ªè¡Œå®ä¾‹åŒ–,æ„é€ å™¨ä¸º<code>private</code>å’Œ<code>public</code>éƒ½æ˜¯ä¸€æ ·çš„.</li>
<li>é™æ€å¯¼å…¥,å¦‚ä¸Šé¢çš„ä¾‹å­.å†åˆ«çš„åœ°ä½¿ç”¨å¯ä»¥ä½¿ç”¨é™æ€å¯¼å…¥ <code>java import static EnumTest.Test.*</code></li>
<li><code>Java</code>çš„<code>switch</code>å­å¥æ”¯æŒçš„ç±»å‹</li>
</ol>
<p>åœ¨Java7ä¸­å¼•å…¥çš„<code>String</code>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä½¿ç”¨<code>int</code>æ¥åšåˆ¤æ–­çš„(<code>hashCode()</code>å’Œ<code>equals()</code>)<br>
- short(Short)<br>
- char(Charactor)<br>
- byte(Byte)<br>
- int(Integer)<br>
- String<br>
- enum<br>
6. æšä¸¾çš„<code>values()</code>é™æ€å‡½æ•°æ˜¯ç”±ç¼–è¯‘å™¨å†™å…¥.å‘ä¸Šè½¬å‹ä¸º<code>Enum</code>åä¸¢å¤±.ä½†å¯ä»¥é€šè¿‡<code>Class</code>çš„<code>getEnumContants()</code>è·å–åˆ°æšä¸¾å…ƒç´ .<br>
7. æšä¸¾å®ç°æŠ½è±¡æ–¹æ³• <code>java enum FontConstant{ Blod{ @Override void show() { //TODO } }, Italilc{ @Override void show() { //TODO } }, Plain{ @Override void show() { //TODO } }; abstract void show(); }</code><br>
8. <code>EnumSet</code>å’Œ<code>EnumMap</code>çš„ä½¿ç”¨</p>
<p>ç”±æ­¤å¯ä»¥çœ‹è§,<code>EnumSet</code>çš„é¡ºåºæ˜¯ä¸<code>enum</code>çš„å£°æ˜æœ‰å…³,å¹¶ä¸”åªèƒ½æ·»åŠ ä¸é‡å¤çš„å¯¹è±¡<br>
- EnumSet<br>
å†…éƒ¨çš„æ•°æ®çš„é¡ºåºä¸<code>add(...)</code>æ—¶çš„é¡ºåºæ²¡æœ‰å…³ç³»,è€Œæ˜¯ä¸<code>enum</code>ä¸­å£°æ˜çš„é¡ºåºä¸€è‡´,</p>
<pre><code>```java
public static void showEnumSet(){      EnumSet&lt;FontConstant&gt; enumSet = EnumSet.noneOf(FontConstant.class);      enumSet.add(FontConstant.Blod);      enumSet.add(FontConstant.Plain);      enumSet.add(FontConstant.Italilc);      enumSet.add(FontConstant.Blod);      for(Iterator&lt;FontConstant&gt; iter = enumSet.iterator(); iter.hasNext();){          System.out.println(iter.next());      }}
```

è¾“å‡º: &gt; Blod Italilc Plain

- EnumMap`EnumMap`ä¸`EnumSet`çš„é¡ºåºæ˜¯ä¸€æ ·çš„.
</code></pre>
<ol start="9">
<li>
<p>æšä¸¾è´£ä»»é“¾</p>
<p>å®ç°ä¾èµ–ä¸æšä¸¾çš„é¡ºåº</p>
<pre><code class="language-java">enum Handler {     HANDLER_1 {         @Override         boolean handler(Action action) {             return action.action == 1;         }     },     HANDLER_2 {         @Override         boolean handler(Action action) {             return action.action == 2;         }     };     abstract boolean handler(Action action);}public static class Action{     int action;     public Action(int action) {         this.action = action;     }}public static void handler(Action action) {     for (Handler handler : Handler.values()) {         if (handler.handler(action)) {             System.out.println(handler.name() + &quot; Handle This Action&quot;);             return;         }     }     System.out.println(&quot;No One Can Handle&quot;);}public static void main(String[] args) {     Action a1 = new Action(1);     handler(a1);     Action a2 = new Action(2);     handler(a2);     Action a3 = new Action(3);     handler(a3);}
</code></pre>
<p>è¾“å‡º &gt; HANDLER_1 Handle This Action HANDLER_2 Handle This Action No One Can Handle</p>
</li>
<li>
<p>æšä¸¾çŠ¶æ€æœº</p>
<p>1ä¸ªäº‹ä»¶çš„å®Œæˆè¦ç»è¿‡A-&gt;B-&gt;C-&gt;Då››ä¸ªçŠ¶æ€,</p>
<pre><code class="language-java">public void process(Status status){  switch(status.getStatus){    case A:       status.setStatus(B);       break;    case B:       status.setStatus(C);       break;    ...  }}
</code></pre>
<p>è¿™æ˜¯ä½¿ç”¨<code>(if/else)/switch</code>å®ç°,æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>enum</code>æ¥å®ç°</p>
<pre><code class="language-java">enum Status {    A {        @Override        void process(Product pro) {            pro.status = B;        }    },    B {        @Override        void process(Product pro) {            System.out.println(&quot;OK&quot;);            pro.status = C;          //reset        }    },    ...    abstract void process(Product pro);}public static class Product{    private Status status = Status.A;    public void make(){        status.process(this);    }}public static void main(String[] args) {    Product product = new Product();    for (int i = 0; i &lt; 10; i++) {        System.out.println(product.status.name());        product.make();    }}
</code></pre>
</li>
<li>
<p>æšä¸¾å¤šè·¯åˆ†å‘<br>
æ ¹æ®å¯¹è±¡çš„ç±»å‹è€Œå¯¹æ–¹æ³•è¿›è¡Œçš„é€‰æ‹©,å°±æ˜¯åˆ†æ´¾(Dispatch)ã€‚</p>
</li>
</ol>
<ul>
<li>
<p>é™æ€åˆ†æ´¾(ç¼–è¯‘æ—¶) <code>java static class A {} static class B extends A {} static class C extends A {} public static void print(A obj){ System.out.println(&quot;A&quot;); } public static void print(B obj){ System.out.println(&quot;B&quot;); } public static void print(C obj){ System.out.println(&quot;C&quot;); } public static void main(String[] args) { A a = new A(); print(a); A b = new B(); print(b); A c = new C(); print(c); }</code> è¾“å‡º &gt; A &gt; A &gt; A</p>
<ul>
<li>
<p>åŠ¨æ€åˆ†æ´¾(è¿è¡Œæ—¶)</p>
<pre><code class="language-java">static class A {    public void print(){        System.out.println(&quot;A&quot;);    }}static class B extends A {    @Override    public void print() {        System.out.println(&quot;B&quot;);    }}static class C extends A {    @Override    public void print() {        System.out.println(&quot;C&quot;);    }}public static void main(String[] args) {    A a = new A();    a.print();    A b = new B();    b.print();    A c = new C();    c.print();}
</code></pre>
<p>è¾“å‡º &gt;A &gt;B &gt;C</p>
</li>
</ul>
</li>
<li>
<p>ä¸¤è·¯åˆ†å‘</p>
<pre><code class="language-java"> public enum Outcome { WIN, LOSE, DRAW } ///:~ interface Item {       Outcome compete(Item it);       Outcome eval(Paper p);       Outcome eval(Scissors s);       Outcome eval(Rock r); } class Paper implements Item {       public Outcome compete(Item it) {           return it.eval(this);       }       public Outcome eval(Paper p) {           return DRAW;       }       public Outcome eval(Scissors s) {           return WIN;       }       public Outcome eval(Rock r) {           return LOSE;       }       public String toString() {           return &quot;Paper&quot;;       }    }     class Scissors implements Item {         public Outcome compete(Item it) {             return it.eval(this);         }         public Outcome eval(Paper p) {             return LOSE;         }         public Outcome eval(Scissors s) {             return DRAW;         }         public Outcome eval(Rock r) {             return WIN;         }         public String toString() {             return &quot;Scissors&quot;;         }     }     class Rock implements Item {         public Outcome compete(Item it) {             return it.eval(this);         }         public Outcome eval(Paper p) {             return WIN;         }         public Outcome eval(Scissors s) {             return LOSE;         }         public Outcome eval(Rock r) {             return DRAW;         }         public String toString() {             return &quot;Rock&quot;;         } } public class RoShamBo1 {     static final int SIZE = 20;     private static Random rand = new Random(47);     public static Item newItem() {         switch (rand.nextInt(3)) {         default:         case 0:             return new Scissors();         case 1:             return new Paper();         case 2:             return new Rock();         }     }     public static void match(Item a, Item b) {         //åœ¨è¿™é‡Œä¸¤ä¸ªå‚æ•°aå’Œbçš„ç±»å‹éƒ½ä¸ç¡®åˆ‡,         //é€šè¿‡åŠ¨æ€è°ƒç”¨a.compete()å¯ä»¥è°ƒåˆ°çœŸå®çš„açš„compete(),         //è€Œåœ¨å…·ä½“ç±»å‹çš„competeé€šè¿‡åŒæ ·çš„æ–¹å¼,è·å–åˆ°bçš„ç¡®åˆ‡ç±»å‹         //åœ¨æ›´å…·é‡è½½çš„æ–¹æ³•è°ƒç”¨åˆ°äº†å…·ä½“çš„æ–¹æ³•         System.out.println(a + &quot; vs. &quot; + b + &quot;: &quot; + a.compete(b));     }     public static void main(String[] args) {         for (int i = 0; i &lt; SIZE; i++)             match(newItem(), newItem());     } }
</code></pre>
<blockquote>
<p>å¤šè·¯åˆ†å‘å°±æ˜¯æŒ‡åœ¨è°ƒç”¨a.plus(b)ï¼Œaå’Œbéƒ½ä¸çŸ¥é“ç¡®åˆ‡ç±»å‹ï¼Œä¹Ÿèƒ½è®©ä»–ä»¬æ­£å¸¸äº¤äº’ã€‚ å¦‚æœæƒ³ä½¿ç”¨ä¸¤è·¯åˆ†å‘ï¼Œé‚£ä¹ˆå¿…é¡»æœ‰ä¸¤ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å†³å®šç¬¬ä¸€ä¸ªæœªçŸ¥ç±»å‹ï¼Œç¬¬äºŒä¸ªæ–¹æ³•è°ƒç”¨å†³å®šç¬¬äºŒä¸ªæœªçŸ¥ç±»å‹ã€‚è¦åˆ©ç”¨å¤šè·¯åˆ†å‘ï¼Œç¨‹åºå‘˜å¿…é¡»ä¸ºæ¯ä¸€ä¸ªç±»å‹æä¾›ç»™ä¸€ä¸ªå®é™…çš„æ–¹æ³•è°ƒç”¨ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œç¨‹åºå‘˜éœ€è¦è®¾å®šå¥½æŸç§é…ç½®ï¼Œä»¥ä¾¿ä¸€ä¸ªæ–¹æ³•è°ƒç”¨èƒ½å¤Ÿå¼•å‡ºæ›´å¤šçš„æ–¹æ³•è°ƒç”¨ï¼Œä»è€Œèƒ½åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¤„ç†å¤šä¸ªç±»å‹ã€‚</p>
</blockquote>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android XMLè§£æ]]></title>
        <id>https://www.kutear.com/post/android-xml-jie-xi/</id>
        <link href="https://www.kutear.com/post/android-xml-jie-xi/">
        </link>
        <updated>2019-06-12T12:47:25.000Z</updated>
        <content type="html"><![CDATA[<h1 id="2016-10-09-android_xml_parser">2016-10-09-Android_Xml_Parser</h1>
<h1 id="view">View</h1>
<p>å¯¹äº<code>View</code>æˆ‘ä»¬å¸¸è§çš„ä½¿ç”¨å°±æ˜¯ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>setContent(int)</code>ï¼Œå¦ä¸€ç§ä¸º<code>LayoutInflater.inflate()</code>,å…¶æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ã€‚çš†ä¸º<code>LayoutInflater.inflate()</code>,æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™é‡Œçš„å…·ä½“å®ç°ã€‚</p>
<pre><code class="language-java">public View inflate(@LayoutRes int resource, @Nullable ViewGroup root, boolean attachToRoot) {    final Resources res = getContext().getResources();    final XmlResourceParser parser = res.getLayout(resource); //æ ¹æ®xmlè¿”å›ä¸€ä¸ªè§£æå™¨    try {        return inflate(parser, root, attachToRoot);    } finally {        parser.close();    }}
</code></pre>
<p>æ¥ç€å°±æ˜¯å‡½æ•°<code>inflate()</code>.</p>
<pre><code class="language-java">public View inflate(XmlPullParser parser, @Nullable ViewGroup root, boolean attachToRoot) {    synchronized (mConstructorArgs) {      final String name = parser.getName();      if (TAG_MERGE.equals(name)) { //å¦‚æœæ˜¯&lt;merge /&gt;æ ‡ç­¾          if (root == null || !attachToRoot) {              throw new InflateException(&quot;&lt;merge /&gt; can be used only with a valid &quot;                      + &quot;ViewGroup root and attachToRoot=true&quot;);          }          //å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°createViewFromTag()ç”ŸæˆView,å¹¶è°ƒç”¨rInflateChildren()é€’å½’è§£æ         rInflate(parser, root, inflaterContext, attrs, false);    } else {        // Temp is the root view that was found in the xml        //æ ¹æ®å½“å‰æ ‡ç­¾tagåˆ›å»ºView        final View temp = createViewFromTag(root, name, inflaterContext, attrs);        ViewGroup.LayoutParams params = null;        if (root != null) {          //è·å–xmlä¸­çš„å±æ€§ï¼Œå¦‚å®½é«˜ï¼Œå¾…ä¸ºviewè®¾ç½®layoutparams            params = root.generateLayoutParams(attrs);            if (!attachToRoot) {                // Set the layout params for temp if we are not                // attaching. (If we are, we use addView, below)                temp.setLayoutParams(params);            }        }        // Inflate all children under temp against its context.        //æŠŠå½“å‰è§£æçš„viewä½œä¸ºparent,ç»§ç»­é€’å½’è§£æå¥¹çš„child View        rInflateChildren(parser, temp, attrs, true);        // We are supposed to attach all the views we found (int temp)        // to root. Do that now.        if (root != null &amp;&amp; attachToRoot) {          //æœ€åæŠŠå½“å‰è§£æçš„viewæ·»åŠ åˆ°ä»–çš„parentä¸­            root.addView(temp, params);        }        // Decide whether to return the root that was passed in or the        // top view found in xml.        if (root == null || !attachToRoot) {            result = temp;        }      }      return result;    }}
</code></pre>
<p>ä¸Šé¢çš„å‡½æ•°éå¸¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„å‡½æ•°å°±æ˜¯<code>createViewFromTag()</code></p>
<pre><code class="language-java">View createViewFromTag(View parent, String name, Context context, AttributeSet attrs,        boolean ignoreThemeAttr) {    if (name.equals(&quot;view&quot;)) {        name = attrs.getAttributeValue(null, &quot;class&quot;);    }    //åŸæ¥xmlè¿˜å¯ä»¥å†™æˆ    //&lt;view class=&quot;TextView&quot; ...&gt;çš„å½¢å¼    //&lt;blink&gt;æ ‡ç­¾  å®ç°é—ªçƒçš„å¦‚&lt;blink&gt;&lt;TextView text=&quot;AA&quot; ...&gt;&lt;/blink&gt; é‚£ä¹ˆAAä¼šé—ªçƒ    if (name.equals(TAG_1995)) {        // Let's party like it's 1995!        return new BlinkLayout(context, attrs);    }    try {        View view;        ...        //è¿™é‡Œæœ‰ä¸€äº›Factoryåˆ›å»ºæ–¹å¼ï¼Œä½†æ˜¯ä»–çš„é€»è¾‘å’Œä¸‹é¢ä¸€æ ·ï¼Œä¸å¤šè¯´        ...        if (view == null) {            final Object lastContext = mConstructorArgs[0];            mConstructorArgs[0] = context;            try {                if (-1 == name.indexOf('.')) {                    view = onCreateView(parent, name, attrs); //ä¸å«. ä¸€å®šæ˜¯ç³»ç»Ÿçš„View,å¦‚TextView                } else {                    view = createView(name, null, attrs);  //éç³»ç»ŸVIew å¦‚æ”¯æŒåº“çš„View,è‡ªå®šä¹‰çš„View                }            } finally {                mConstructorArgs[0] = lastContext;            }        }        return view;    } catch (InflateException e) {      ...    }}
</code></pre>
<p>é€šè¿‡æºç ï¼Œæˆ‘ä»¬å‘ç°<code>onCreateView(..)</code>å…¶å®æ˜¯è°ƒç”¨<code>createView(name, &quot;android.view.&quot;, attrs)</code>,åªæ˜¯äººä¸ºçš„åŠ ä¸ŠViewçš„å‰ç¼€ã€‚</p>
<pre><code class="language-java">public final View createView(String name, String prefix, AttributeSet attrs)        throws ClassNotFoundException, InflateException {    Constructor&lt;? extends View&gt; constructor = sConstructorMap.get(name);  //æ„é€ å‡½æ•°ç¼“å­˜    Class&lt;? extends View&gt; clazz = null;    try {        if (constructor == null) {            // Class not found in the cache, see if it's real, and try to add it            clazz = mContext.getClassLoader().loadClass(                    prefix != null ? (prefix + name) : name).asSubclass(View.class);            ...            //    static final Class&lt;?&gt;[] mConstructorSignature = new Class[] {            //                                Context.class, AttributeSet.class};            constructor = clazz.getConstructor(mConstructorSignature);//è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆViewåœ¨xmlå®ä¾‹æ—¶è°ƒç”¨ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°            constructor.setAccessible(true);            sConstructorMap.put(name, constructor);        } else {            // If we have a filter, apply it to cached constructor            if (mFilter != null) {                // Have we seen this name before?                Boolean allowedState = mFilterMap.get(name);                if (allowedState == null) {                    // New class -- remember whether it is allowed                    clazz = mContext.getClassLoader().loadClass(                            prefix != null ? (prefix + name) : name).asSubclass(View.class);                    boolean allowed = clazz != null &amp;&amp; mFilter.onLoadClass(clazz);                    mFilterMap.put(name, allowed);                    if (!allowed) {                        failNotAllowed(name, prefix, attrs);                    }                } else if (allowedState.equals(Boolean.FALSE)) {                    failNotAllowed(name, prefix, attrs);                }            }        }        Object[] args = mConstructorArgs;        args[1] = attrs;        final View view = constructor.newInstance(args); //å®ä¾‹åŒ–Viewå¯¹è±¡        if (view instanceof ViewStub) {            // Use the same context when inflating ViewStub later.            final ViewStub viewStub = (ViewStub) view;            //å¯¹äºViewStub,ç°åœ¨è¿˜æ²¡è§£æå…¶å†…éƒ¨ç»“æ„ï¼Œå¾…è°ƒç”¨å‡½æ•°inflate()æ—¶æ‰è§£ææ›¿æ¢ä¸ºå†…éƒ¨çš„Viewã€‚            viewStub.setLayoutInflater(cloneInContext((Context) args[0]));        }        return view;    } catch (NoSuchMethodException e) {      ...    }}
</code></pre>
<p>åˆ°æ­¤Viewçš„è§£æå°±ç®—å®Œäº†ã€‚</p>
<h1 id="drawable">Drawable</h1>
<p>è¿™é‡Œä»¥Backgroundä¸ºä¾‹è¯´æ˜ï¼Œåœ¨Viewçš„æ„é€ å“ˆæ•°ä¸­å­˜åœ¨è¿™æ ·ä¸€æ®µä»£ç </p>
<pre><code class="language-java">//View.javafinal TypedArray a = context.obtainStyledAttributes(                attrs, com.android.internal.R.styleable.View, defStyleAttr, defStyleRes);int attr = a.getIndex(i);switch (attr) {    case com.android.internal.R.styleable.View_background:        background = a.getDrawable(attr);        break;    case ..}
</code></pre>
<pre><code class="language-java">//TypedArray.java@Nullablepublic Drawable getDrawable(int index) {  ...  return mResources.loadDrawable(value, value.resourceId, mTheme);}
</code></pre>
<p>åœ¨<code>loadDrawable()</code>å½“ä¸­ï¼Œåšäº†ä¸€äº›åˆ¤æ–­ï¼Œæ¯”å¦‚å½“å‰è¦çš„<code>Drawable</code>æ˜¯å¦å·²ç»åŠ è½½è¿‡äº†ï¼Œå³åˆ¤æ–­æ˜¯å¦å·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œå¦‚æœåœ¨å°±ä¸éœ€è¦ä»xmlä¸­åŠ è½½ï¼Œåä¹‹å°±éœ€è¦åŠ è½½ï¼Œå¹¶ä¿å­˜åœ¨ç¼“å­˜ä¸­ã€‚è€ŒåŠ è½½å°±æ˜¯è°ƒç”¨å‡½æ•°<code>loadDrawableForCookie()</code>,ä¸‹é¢çœ‹çœ‹å…·ä½“çš„å®ç°ã€‚</p>
<pre><code class="language-java">private Drawable loadDrawableForCookie(TypedValue value, int id, Theme theme) {    if (value.string == null) {        throw new NotFoundException(&quot;Resource \&quot;&quot; + getResourceName(id) + &quot;\&quot; (&quot;                + Integer.toHexString(id) + &quot;) is not a Drawable (color or path): &quot; + value);    }    final String file = value.string.toString(); //è¿™é‡Œæ˜¯æ–‡ä»¶çš„è·¯å¾„ å¦‚res/drawable/xxx.png    final Drawable dr;    try {        if (file.endsWith(&quot;.xml&quot;)) {            final XmlResourceParser rp = loadXmlResourceParser(                    file, id, value.assetCookie, &quot;drawable&quot;);            dr = Drawable.createFromXml(this, rp, theme);            rp.close();        } else {            final InputStream is = mAssets.openNonAsset(                    value.assetCookie, file, AssetManager.ACCESS_STREAMING);            dr = Drawable.createFromResourceStream(this, value, is, file, null);            is.close();        }    } catch (Exception e) {    }    return dr;}
</code></pre>
<p>å¾ˆå®¹æ˜“çœ‹åˆ°ï¼Œè¿™é‡Œä»¥xmlç»“å°¾çš„æ–‡ä»¶å’Œå…¶ä»–å¦‚pngç»“å°¾çš„æ–‡ä»¶åšäº†åˆ†åˆ«å¤„ç†ï¼Œå…ˆçœ‹çœ‹ç®€å•çš„æ™®é€šçš„å›¾ç‰‡æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯<code>else</code>ä¸­çš„ä»£ç ã€‚å¯ä»¥çœ‹è§æ˜¯å¾ˆç®€å•çš„å®ç°ï¼Œå°±æ˜¯æŠŠå›¾ç‰‡è½¬æ¢ä¸ºæ•°æ®æµï¼Œåœ¨é€šè¿‡æ•°æ®æµæ„å»ºDrawableå¯¹è±¡ã€‚é‡ç‚¹çœ‹çœ‹xmlç±»å‹Drawableçš„ç”Ÿæˆå§ã€‚è·Ÿå…¥è¿›å»ï¼Œæˆ‘ä»¬å‘ç°æœ‰ä¸ªç‰¹åˆ«çš„å‡½æ•°<code>createFromXmlInner()</code>ï¼Œä¸ºä»€ä¹ˆè¯´ç‰¹åˆ«ï¼Ÿå› ä¸ºå®ƒå°±æ˜¯åˆ›å»ºå…·ä½“<code>Drawable</code>çš„å‡½æ•°ã€‚</p>
<pre><code class="language-java">public static Drawable createFromXmlInner(Resources r, XmlPullParser parser, AttributeSet attrs,        Theme theme) throws XmlPullParserException, IOException {    final Drawable drawable;    final String name = parser.getName();    switch (name) {        case &quot;selector&quot;:            drawable = new StateListDrawable();            break;        case &quot;animated-selector&quot;:            drawable = new AnimatedStateListDrawable();            break;        case &quot;level-list&quot;:            drawable = new LevelListDrawable();            break;        case &quot;layer-list&quot;:            drawable = new LayerDrawable();            break;        case &quot;transition&quot;:            drawable = new TransitionDrawable();            break;        case &quot;ripple&quot;:            drawable = new RippleDrawable();            break;        case &quot;color&quot;:            drawable = new ColorDrawable();            break;        case &quot;shape&quot;:            drawable = new GradientDrawable();            break;        case &quot;vector&quot;:            drawable = new VectorDrawable();            break;        case &quot;animated-vector&quot;:            drawable = new AnimatedVectorDrawable();            break;        case &quot;scale&quot;:            drawable = new ScaleDrawable();            break;        case &quot;clip&quot;:            drawable = new ClipDrawable();            break;        case &quot;rotate&quot;:            drawable = new RotateDrawable();            break;        case &quot;animated-rotate&quot;:            drawable = new AnimatedRotateDrawable();            break;        case &quot;animation-list&quot;:            drawable = new AnimationDrawable();            break;        case &quot;inset&quot;:            drawable = new InsetDrawable();            break;        case &quot;bitmap&quot;:            drawable = new BitmapDrawable();            break;        case &quot;nine-patch&quot;:            drawable = new NinePatchDrawable();            break;        default:            throw new XmlPullParserException(parser.getPositionDescription() +                    &quot;: invalid drawable tag &quot; + name);    }    drawable.inflate(r, parser, attrs, theme);    return drawable;}
</code></pre>
<p>å‰é¢çš„<code>switch</code>å°±æ˜¯ç®€å•çš„æ ¹æ®æ ‡ç­¾tagåˆ›å»ºå…·ä½“çš„å¯¹è±¡ï¼Œæœ€åè°ƒç”¨<code>drawable.inflate()</code>æ¥é…ç½®å…·ä½“çš„å‚æ•°ã€‚è¿™é‡Œæˆ‘ä»¬ä¸€å¸§åŠ¨ç”»<code>AnimationDrawable</code>æ¥è¯´æ˜ã€‚</p>
<pre><code class="language-java">@Overridepublic void inflate(Resources r, XmlPullParser parser, AttributeSet attrs, Theme theme)        throws XmlPullParserException, IOException {    final TypedArray a = obtainAttributes(r, theme, attrs, R.styleable.AnimationDrawable);    super.inflateWithAttributes(r, parser, a, R.styleable.AnimationDrawable_visible);    updateStateFromTypedArray(a);    a.recycle();    inflateChildElements(r, parser, attrs, theme);}private void inflateChildElements(Resources r, XmlPullParser parser, AttributeSet attrs,        Theme theme) throws XmlPullParserException, IOException {    int type;    final int innerDepth = parser.getDepth()+1;    int depth;    //å¾ªç¯è·å–æ¯ä¸€å¸§åŠ¨ç”»ä¿¡æ¯    while ((type=parser.next()) != XmlPullParser.END_DOCUMENT            &amp;&amp; ((depth = parser.getDepth()) &gt;= innerDepth || type != XmlPullParser.END_TAG)) {        if (type != XmlPullParser.START_TAG) {            continue;        }        if (depth &gt; innerDepth || !parser.getName().equals(&quot;item&quot;)) {            continue;        }        //å–å¾—æ¯ä¸ªåä¸ºitemçš„tagç»“ç‚¹        final TypedArray a = obtainAttributes(r, theme, attrs,                R.styleable.AnimationDrawableItem);        final int duration = a.getInt(R.styleable.AnimationDrawableItem_duration, -1);        if (duration &lt; 0) {            throw new XmlPullParserException(parser.getPositionDescription()                    + &quot;: &lt;item&gt; tag requires a 'duration' attribute&quot;);        }        Drawable dr = a.getDrawable(R.styleable.AnimationDrawableItem_drawable); //æŒ‰ç…§è§£æpngçš„æ–¹å¼è§£æ        a.recycle();        if (dr == null) {            while ((type=parser.next()) == XmlPullParser.TEXT) {                // Empty            }            if (type != XmlPullParser.START_TAG) {                throw new XmlPullParserException(parser.getPositionDescription()                        + &quot;: &lt;item&gt; tag requires a 'drawable' attribute or child tag&quot;                        + &quot; defining a drawable&quot;);            }            dr = Drawable.createFromXmlInner(r, parser, attrs, theme);  //itemå†…éƒ¨å†åµŒxmlç±»å‹çš„Drawable        }        mAnimationState.addFrame(dr, duration); //æ·»åŠ åˆ°å­˜å‚¨æ¯ä¸€å¸§çš„å®¹å™¨ï¼Œå¸¦æ’­æ”¾æ—¶ä½¿ç”¨        if (dr != null) {            dr.setCallback(this);        }    }}
</code></pre>
<p>å¯¹äº<code>Drawable</code>çš„è§£æå¤§ä½“å°±è¿™äº›ã€‚ # Animation æˆ‘ä»¬çŸ¥é“ï¼ŒAndroidåŠ¨ç”»å¤§ä½“åˆ†ä¸ºä¸‰ç±»ï¼Œå¸§åŠ¨ç”»ï¼ŒView åŠ¨ç”»ï¼Œå’Œå±æ€§åŠ¨ç”»ã€‚å¸§åŠ¨ç”»åœ¨ä¸Šé¢Drawableå·²ç»è¯´è¿‡äº†ã€‚è€ŒViewåŠ¨ç”»å’Œå±æ€§åŠ¨ç”»åŸºæœ¬ä¸€æ ·çš„è§£æã€‚ä¸‹é¢ä»¥å±æ€§åŠ¨ç”»ä¸ºä¾‹çœ‹ä¸€ä¸‹ã€‚æˆ‘ä»¬é€‰æ‹©ä»å‡½æ•°<code>loadAnimator(Context context, @AnimatorRes int id)</code>å…¥æ‰‹ã€‚</p>
<pre><code class="language-java">public static Animator loadAnimator(Resources resources, Theme theme, int id,            float pathErrorScale) throws NotFoundException {        final ConfigurationBoundResourceCache&lt;Animator&gt; animatorCache = resources                .getAnimatorCache();        Animator animator = animatorCache.getInstance(id, theme); //ä¼˜å…ˆç¼“å­˜è¯»å–        if (animator != null) {            return animator;        } else if (DBG_ANIMATOR_INFLATER) {            Log.d(TAG, &quot;cache miss for animator &quot; + resources.getResourceName(id));        }        //ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œéœ€è¦è§£æ        XmlResourceParser parser = null;        try {            parser = resources.getAnimation(id);            animator = createAnimatorFromXml(resources, theme, parser, pathErrorScale);//åŠ¨ç”»çš„åˆ›å»º            if (animator != null) {                animator.appendChangingConfigurations(getChangingConfigs(resources, id));                final ConstantState&lt;Animator&gt; constantState = animator.createConstantState();                if (constantState != null) {                    if (DBG_ANIMATOR_INFLATER) {                        Log.d(TAG, &quot;caching animator for res &quot; + resources.getResourceName(id));                    }                    animatorCache.put(id, theme, constantState);                    // create a new animator so that cached version is never used by the user                    // è¿™é‡Œçš„æ³¨é‡Šè¯´æ˜æ¯æ¬¡ä»ç¼“å­˜ä¸­è¯»å–çš„cacheå…¶å®ä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„ã€‚                    animator = constantState.newInstance(resources, theme);                }            }            return animator;        } catch (XmlPullParserException ex) {            ...        } finally {            if (parser != null) parser.close();        }    }
</code></pre>
<p>æ¯•ç«Ÿè¿™ä¸æ˜¯æˆ‘ä»¬è¿™é‡Œéœ€è¦ä¸»è¦å…³æ³¨çš„ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹åˆ›å»ºçš„å‡½æ•°<code>createAnimatorFromXml()</code>.</p>
<pre><code class="language-java">private static Animator createAnimatorFromXml(Resources res, Theme theme, XmlPullParser parser,        AttributeSet attrs, AnimatorSet parent, int sequenceOrdering, float pixelSize)        throws XmlPullParserException, IOException {    Animator anim = null;    ArrayList&lt;Animator&gt; childAnims = null;    // Make sure we are on a start tag.    int type;    int depth = parser.getDepth();    while (((type = parser.next()) != XmlPullParser.END_TAG || parser.getDepth() &gt; depth)            &amp;&amp; type != XmlPullParser.END_DOCUMENT) {        if (type != XmlPullParser.START_TAG) {            continue;        }        String name = parser.getName();        boolean gotValues = false;        if (name.equals(&quot;objectAnimator&quot;)) {  //ç”ŸæˆobjectAnimator            anim = loadObjectAnimator(res, theme, attrs, pixelSize);        } else if (name.equals(&quot;animator&quot;)) { //ValueAnimator            anim = loadAnimator(res, theme, attrs, null, pixelSize);  //é€’å½’è¿‡ç¨‹        } else if (name.equals(&quot;set&quot;)) {  //AnimatorSet            //æˆ‘ä»¬çŸ¥é“ï¼ŒAnimatorSetæ˜¯ä¸ªå®¹å™¨ï¼Œè¿™é‡Œçš„é€»è¾‘å°±æ˜¯æŠŠå®ƒä½œä¸ºparent,åœ¨é€’å½’è§£æå­å…ƒç´             anim = new AnimatorSet();            TypedArray a;            if (theme != null) {                a = theme.obtainStyledAttributes(attrs, R.styleable.AnimatorSet, 0, 0);            } else {                a = res.obtainAttributes(attrs, R.styleable.AnimatorSet);            }            anim.appendChangingConfigurations(a.getChangingConfigurations());            int ordering = a.getInt(R.styleable.AnimatorSet_ordering, TOGETHER);            createAnimatorFromXml(res, theme, parser, attrs, (AnimatorSet) anim, ordering,                    pixelSize); //é€’å½’è°ƒç”¨            a.recycle();        } else if (name.equals(&quot;propertyValuesHolder&quot;)) {  //è¿™é‡Œé¢è¿˜ä¼šè§£ækeyframeæ ‡ç­¾            PropertyValuesHolder[] values = loadValues(res, theme, parser,                    Xml.asAttributeSet(parser));            if (values != null &amp;&amp; anim != null &amp;&amp; (anim instanceof ValueAnimator)) {                ((ValueAnimator) anim).setValues(values);            }            gotValues = true;        } else {            throw new RuntimeException(&quot;Unknown animator name: &quot; + parser.getName());        }        if (parent != null &amp;&amp; !gotValues) {            if (childAnims == null) {                childAnims = new ArrayList&lt;Animator&gt;();            }            childAnims.add(anim);        }    }    //ç”Ÿæˆå®Œæ¯•ï¼Œè€ƒè™‘æ·»åŠ åˆ°Parent    if (parent != null &amp;&amp; childAnims != null) {        Animator[] animsArray = new Animator[childAnims.size()];        int index = 0;        for (Animator a : childAnims) {            animsArray[index++] = a;        }        if (sequenceOrdering == TOGETHER) {            parent.playTogether(animsArray);        } else {            parent.playSequentially(animsArray);        }    }    return anim;}
</code></pre>
<p>æœ‰ç‚¹æŠ½è±¡ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªå°ä¾‹å­çœ‹çœ‹åŠ¨ç”»çš„æ‰€æœ‰ç»“æ„ã€‚</p>
<pre><code class="language-xml">&lt;set android:ordering=&quot;sequentially&quot;&gt;      &lt;animator            android:duration=&quot;1000&quot;            android:repeatCount=&quot;1&quot;            android:repeatMode=&quot;reverse&quot;&gt;      &lt;propertyValuesHolder&gt;          &lt;keyframe android:fraction=&quot;0&quot; android:value=&quot;1&quot;/&gt;          &lt;keyframe android:fraction=&quot;.2&quot; android:value=&quot;.4&quot;/&gt;          &lt;keyframe android:fraction=&quot;1&quot; android:value=&quot;0&quot;/&gt;      &lt;/propertyValuesHolder&gt;    &lt;/animator&gt;    &lt;objectAnimator        android:duration=&quot;500&quot;        android:valueTo=&quot;1f&quot;&gt;          &lt;propertyValuesHolder android:propertyName=&quot;x&quot; &gt;                &lt;keyframe android:fraction=&quot;0&quot; android:value=&quot;800&quot; /&gt;                &lt;keyframe android:fraction=&quot;.2&quot;                          android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;                          android:value=&quot;1000&quot; /&gt;                &lt;keyframe android:fraction=&quot;1&quot;                          android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;                          android:value=&quot;400&quot; /&gt;          &lt;/propertyValuesHolder&gt;          &lt;propertyValuesHolder android:propertyName=&quot;y&quot; &gt;                &lt;keyframe/&gt;                &lt;keyframe android:fraction=&quot;.2&quot;                          android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;                          android:value=&quot;300&quot;/&gt;                &lt;keyframe android:interpolator=&quot;@android:anim/accelerate_interpolator&quot;                          android:value=&quot;1000&quot; /&gt;          &lt;/propertyValuesHolder&gt;      &lt;/objectAnimator&gt;&lt;/set&gt;
</code></pre>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥ä»¥<code>&lt;propertyValuesHolder/&gt;</code>çš„è§£æä¸ºä¾‹æ¥è¯´æ˜ã€‚</p>
<pre><code class="language-java">private static PropertyValuesHolder[] loadValues(Resources res, Theme theme,            XmlPullParser parser, AttributeSet attrs) throws XmlPullParserException, IOException {        ArrayList&lt;PropertyValuesHolder&gt; values = null;        int type;        while ((type = parser.getEventType()) != XmlPullParser.END_TAG &amp;&amp;                type != XmlPullParser.END_DOCUMENT) {            if (type != XmlPullParser.START_TAG) {                parser.next();                continue;            }            String name = parser.getName();            if (name.equals(&quot;propertyValuesHolder&quot;)) {                TypedArray a;                if (theme != null) {                    a = theme.obtainStyledAttributes(attrs, R.styleable.PropertyValuesHolder, 0, 0);                } else {                    a = res.obtainAttributes(attrs, R.styleable.PropertyValuesHolder);                }                String propertyName = a.getString(R.styleable.PropertyValuesHolder_propertyName);                int valueType = a.getInt(R.styleable.PropertyValuesHolder_valueType,                        VALUE_TYPE_UNDEFINED);                PropertyValuesHolder pvh = loadPvh(res, theme, parser, propertyName, valueType);                if (pvh == null) {                    pvh = getPVH(a, valueType,                            R.styleable.PropertyValuesHolder_valueFrom,                            R.styleable.PropertyValuesHolder_valueTo, propertyName);                }                if (pvh != null) {                    if (values == null) {                        values = new ArrayList&lt;PropertyValuesHolder&gt;();                    }                    values.add(pvh);                }                a.recycle();            }            parser.next();        }        PropertyValuesHolder[] valuesArray = null;        if (values != null) {            int count = values.size();            valuesArray = new PropertyValuesHolder[count];            for (int i = 0; i &lt; count; ++i) {                valuesArray[i] = values.get(i);            }        }        return valuesArray;    }
</code></pre>
<p>ä¸Šé¢ä»£ç æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼Œå”¯ä¸€è¦çœ‹çš„å°±æ˜¯<code>PropertyValuesHolder</code>çš„åˆ›å»ºå‡½æ•°<code>loadPvh()</code>ã€‚</p>
<pre><code class="language-java">private static PropertyValuesHolder loadPvh(Resources res, Theme theme, XmlPullParser parser,        String propertyName, int valueType)        throws XmlPullParserException, IOException {    PropertyValuesHolder value = null;    ArrayList&lt;Keyframe&gt; keyframes = null;    int type;    while ((type = parser.next()) != XmlPullParser.END_TAG &amp;&amp;            type != XmlPullParser.END_DOCUMENT) {        String name = parser.getName();        if (name.equals(&quot;keyframe&quot;)) {            if (valueType == VALUE_TYPE_UNDEFINED) {                valueType = inferValueTypeOfKeyframe(res, theme, Xml.asAttributeSet(parser));            }            //è§£ækeyframe            Keyframe keyframe = loadKeyframe(res, theme, Xml.asAttributeSet(parser), valueType);            if (keyframe != null) {                if (keyframes == null) {                    keyframes = new ArrayList&lt;Keyframe&gt;();                }                keyframes.add(keyframe);            }            parser.next();        }    }    int count;    if (keyframes != null &amp;&amp; (count = keyframes.size()) &gt; 0) {        ...å¯¹keyframesçš„è°ƒæ•´        value = PropertyValuesHolder.ofKeyframe(propertyName, keyframeArray); //è®¾ç½®keyframe        if (valueType == VALUE_TYPE_COLOR) {            value.setEvaluator(ArgbEvaluator.getInstance());//è®¾ç½®ä¼°å€¼å™¨        }    }    return value;}
</code></pre>
<p>å§æ§½ï¼Œä¸€å±‚ä¸€å±‚ä½•æ—¶èƒ½åˆ°å¤´ã€‚</p>
<pre><code class="language-java">private static Keyframe loadKeyframe(Resources res, Theme theme, AttributeSet attrs,        int valueType)        throws XmlPullParserException, IOException {    TypedArray a;    if (theme != null) {        a = theme.obtainStyledAttributes(attrs, R.styleable.Keyframe, 0, 0);    } else {        a = res.obtainAttributes(attrs, R.styleable.Keyframe);    }    Keyframe keyframe = null;    float fraction = a.getFloat(R.styleable.Keyframe_fraction, -1);    TypedValue keyframeValue = a.peekValue(R.styleable.Keyframe_value);    boolean hasValue = (keyframeValue != null);    if (valueType == VALUE_TYPE_UNDEFINED) {        // When no value type is provided, check whether it's a color type first.        // If not, fall back to default value type (i.e. float type).        if (hasValue &amp;&amp; isColorType(keyframeValue.type)) {            valueType = VALUE_TYPE_COLOR;        } else {            valueType = VALUE_TYPE_FLOAT;        }    }    if (hasValue) {        switch (valueType) {            case VALUE_TYPE_FLOAT:                float value = a.getFloat(R.styleable.Keyframe_value, 0);                keyframe = Keyframe.ofFloat(fraction, value);                break;            case VALUE_TYPE_COLOR:            case VALUE_TYPE_INT:                int intValue = a.getInt(R.styleable.Keyframe_value, 0);                keyframe = Keyframe.ofInt(fraction, intValue);                break;        }    } else {        keyframe = (valueType == VALUE_TYPE_FLOAT) ? Keyframe.ofFloat(fraction) :                Keyframe.ofInt(fraction);    }    final int resID = a.getResourceId(R.styleable.Keyframe_interpolator, 0);    if (resID &gt; 0) {        final Interpolator interpolator = AnimationUtils.loadInterpolator(res, theme, resID); //æ’å€¼å™¨ï¼Œå’ŒViewåŠ¨ç”»ä¸€è‡´        keyframe.setInterpolator(interpolator);    }    a.recycle();    return keyframe;}
</code></pre>
<p>ä¸Šé¢å‡½æ•°å¾ˆç®€å•ï¼Œå°±æ˜¯æ ¹æ®ä¸åŒçš„typeç”Ÿæˆä¸åŒçš„keyframe,è€Œtypeæˆ‘ä»¬ä»ä¸Šé¢çŸ¥é“æ˜¯ä»TypedValue.typeæ¥åˆ¤æ–­çš„ã€‚TypedValueä¸­æŒæœ‰å¾ˆå¤šçš„typeå£°æ˜</p>
<pre><code class="language-java">...public static final int TYPE_DIMENSION = 0x05;/** The &lt;var&gt;data&lt;/var&gt; field holds a complex number encoding a fraction *  of a container. */public static final int TYPE_FRACTION = 0x06;...
</code></pre>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œå°±ç®—åˆ†æå®Œäº†,é‡Œé¢æœ‰å¾ˆå¤šä»£ç ç°åœ¨è¿˜æ˜¯ä¸å¤ªæ¸…æ¥šå…·ä½“çš„é€»è¾‘ã€‚ä½†æ˜¯æˆ‘ä»¬æµç¨‹è¿˜æ˜¯ç®—æ¸…æ¥šçš„äº†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://www.kutear.com/post/hello-gridea/</id>
        <link href="https://www.kutear.com/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="https://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android SparseArray]]></title>
        <id>https://www.kutear.com/post/android-sparsearray/</id>
        <link href="https://www.kutear.com/post/android-sparsearray/">
        </link>
        <updated>2018-03-12T12:50:17.000Z</updated>
        <content type="html"><![CDATA[<h2 id="put">Put</h2>
<pre><code class="language-java">//SparseArray.javapublic void put(int key, E value) {       //äºŒåˆ†æŸ¥æ‰¾,SparseArrayæ˜¯ç”±å°åˆ°å¤§æ’åºçš„       //æ‰¾åˆ°æ˜¯è¿”å›è¯¥keyå¯¹åº”çš„index       //æ²¡æ‰¾åˆ°æ—¶è¯¥keyåœ¨è¿™æ—¶åº”è¯¥æ”¾ç½®indexçš„è¡¥è¿ç®—çš„ç»“æœ(è´Ÿæ•°)        int i = ContainerHelpers.binarySearch(mKeys, mSize, key);        if (i &gt;= 0) {  //æ‰¾åˆ°            mValues[i] = value;        } else { //æ²¡æ‰¾åˆ°            i = ~i;  //æ±‚è¡¥,å¾—åˆ°è¯¥æ”¾ç½®çš„ä½ç½®.            if (i &lt; mSize &amp;&amp; mValues[i] == DELETED) {  //è¯¥æ”¾ç½®çš„ä½ç½®æ²¡æœ‰æ•°æ®åœ¨è¿˜æ²¡æœ‰å…ƒç´ /1ä¸ªå…ƒç´ æˆ–è€…æœ‰è¿›è¡Œåˆ é™¤æ•°æ®çš„æ—¶å€™å‡ºç°                mKeys[i] = key;                mValues[i] = value;                return;            }            if (mGarbage &amp;&amp; mSize &gt;= mKeys.length) {                gc(); //æ•°æ®ç´§å‡‘                // Search again because indices may have changed.                i = ~ContainerHelpers.binarySearch(mKeys, mSize, key);            }            mKeys = GrowingArrayUtils.insert(mKeys, mSize, i, key);            mValues = GrowingArrayUtils.insert(mValues, mSize, i, value);            mSize++;        }}
</code></pre>
<pre><code class="language-java">//SparseArray.java//ä½¿æ•°æ®ç´§å‡‘(æ•°æ®é›†ä¸­åœ¨æ•°ç»„å‰ç«¯)private void gc() {        // Log.e(&quot;SparseArray&quot;, &quot;gc start with &quot; + mSize);        int n = mSize;        int o = 0;        int[] keys = mKeys;        Object[] values = mValues;        for (int i = 0; i &lt; n; i++) {            Object val = values[i];            if (val != DELETED) {                if (i != o) {                    keys[o] = keys[i];                    values[o] = val;                    values[i] = null;                }                o++;            }        }        mGarbage = false;        mSize = o;        // Log.e(&quot;SparseArray&quot;, &quot;gc end with &quot; + mSize);}
</code></pre>
<pre><code class="language-java">//ContainerHelpers.java// This is Arrays.binarySearch(), but doesn't do any argument validation.//[ä¸åšå‚æ•°èŒƒå›´æ£€æµ‹]static int binarySearch(int[] array, int size, int value) {        int lo = 0;        int hi = size - 1;        while (lo &lt;= hi) {            final int mid = (lo + hi) &gt;&gt;&gt; 1;            final int midVal = array[mid];            if (midVal &lt; value) {                lo = mid + 1;            } else if (midVal &gt; value) {                hi = mid - 1;            } else {                return mid;  // value found            }        }        return ~lo;  // value not present}
</code></pre>
<pre><code class="language-java">//GrowingArrayUtils.javapublic static &lt;T&gt; T[] insert(T[] array, int currentSize, int index, T element) {        assert currentSize &lt;= array.length;        if (currentSize + 1 &lt;= array.length) {            //(T[] src, int srcPos, T[] dst, int dstPos, int length)            //ä¹Ÿå°±æ˜¯æŠŠarrayçš„index(åŒ…æ‹¬è‡ªèº«)åçš„å…ƒç´ å¾€åç§»åŠ¨1ä¸ªå•ä½            System.arraycopy(array, index, array, index + 1, currentSize - index);            array[index] = element;            return array;        }        //æ•°ç»„å®¹é‡ä¸å¤Ÿ,æ‰©å®¹        @SuppressWarnings(&quot;unchecked&quot;)        T[] newArray = ArrayUtils.newUnpaddedArray((Class&lt;T&gt;)array.getClass().getComponentType(),                growSize(currentSize));        //growSize(currentSize) ==&gt; return currentSize &lt;= 4 ? 8 : currentSize * 2;        System.arraycopy(array, 0, newArray, 0, index);        newArray[index] = element;        System.arraycopy(array, index, newArray, index + 1, array.length - index);        return newArray;}
</code></pre>
<h2 id="delete-remove">Delete &amp; Remove</h2>
<pre><code class="language-java">//SparseArray.javapublic void remove(int key) {        delete(key);}public void delete(int key) {        int i = ContainerHelpers.binarySearch(mKeys, mSize, key);        if (i &gt;= 0) {            if (mValues[i] != DELETED) {                mValues[i] = DELETED;                mGarbage = true;                //åœ¨è¿™é‡Œå¹¶æ²¡æœ‰æŠŠmSizeå‡ä¸€å’Œåšæ•°ç»„ç´§ç¼©æ“ä½œï¼Œè€Œæ˜¯åœ¨è¦ç”¨çš„åšï¼Œ               //æ¯”å¦‚è°ƒgetSize()å°±ä¼šåšæ•°ç»„ç´§ç¼©ï¼Œè¿™æ ·æ‰å¯ä»¥å¾—åˆ°çœŸæ­£çš„size            }        }}
</code></pre>
<h2 id="append">Append</h2>
<pre><code class="language-java">//SparseArray.java//ç”±äºSparseArrayå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸºäºäºŒåˆ†æŸ¥æ‰¾ç®—æ³•,æ‰€ä»¥appendçš„å®ç°è‚¯å®šä¸èƒ½//ç›´æ¥appendpublic void append(int key, E value) {        //å¦‚æœå€¼ä¸å¤Ÿå¤§,å½“ç„¶æ’ä¸åˆ°æœ€å,è½¬ä¸ºput        if (mSize != 0 &amp;&amp; key &lt;= mKeys[mSize - 1]) {            put(key, value);            return;        }        if (mGarbage &amp;&amp; mSize &gt;= mKeys.length) {            gc();        }        mKeys = GrowingArrayUtils.append(mKeys, mSize, key);        mValues = GrowingArrayUtils.append(mValues, mSize, value);        mSize++;}
</code></pre>
<pre><code class="language-java">//GrowingArrayUtils.javapublic static &lt;T&gt; T[] append(T[] array, int currentSize, T element) {        assert currentSize &lt;= array.length;        //ç”³è¯·æ–°å®¹é‡        if (currentSize + 1 &gt; array.length) {            @SuppressWarnings(&quot;unchecked&quot;)            T[] newArray = ArrayUtils.newUnpaddedArray(                    (Class&lt;T&gt;) array.getClass().getComponentType(), growSize(currentSize));            System.arraycopy(array, 0, newArray, 0, currentSize);            array = newArray;        }        array[currentSize] = element;        return array;}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¼¹å¹•ä¼˜åŒ–]]></title>
        <id>https://www.kutear.com/post/dan-mu-you-hua/</id>
        <link href="https://www.kutear.com/post/dan-mu-you-hua/">
        </link>
        <updated>2017-07-12T12:46:01.000Z</updated>
        <content type="html"><![CDATA[<h1 id="èƒŒæ™¯">èƒŒæ™¯</h1>
<p>å¼¹å¹•ä½œä¸ºå›½å†…ç›´æ’­å¹³å°å¿…ä¸å¯å°‘çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œå…¶æ€§èƒ½çš„å¥½åç›´æ¥å½±å“ç”¨æˆ·è§‚çœ‹è§†é¢‘çš„ä½“éªŒã€‚ä¼é¹…ç”µç«ä½¿ç”¨çš„æ˜¯Bç«™çš„å¼¹å¹•ç»„ä»¶(ä¿®æ”¹äº†æ’ç‰ˆçš„é€»è¾‘)ï¼Œå®ƒçš„æœ€åä¸€æ¬¡ç»´æŠ¤ä¹Ÿæ˜¯åœ¨ä¸¤å¹´å‰äº†ï¼Œæ›´é‡è¦çš„æ˜¯éšç€ç”µç«ä¸šåŠ¡çš„å‘å±•ï¼Œè¯¥ç»„ä»¶ä¸è®ºæ˜¯åœ¨åŠŸèƒ½è¿˜æ˜¯æ€§èƒ½æ–¹é¢éƒ½æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬å‡†å¤‡å®ç°ä¸€å¥—æ»¡è¶³ç”µç«ä¸šåŠ¡çš„å¼¹å¹•ç»„ä»¶ã€‚</p>
<h1 id="å®ç°">å®ç°</h1>
<p>åœ¨å¼€å§‹ä»‹ç»æ–°çš„å¼¹å¹•ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Bç«™å¼¹å¹•ç»„ä»¶çš„åŸç†åŠé—®é¢˜ã€‚ Bç«™å¼¹å¹•æ”¯æŒ</p>
<pre><code>View
</code></pre>
<p>,</p>
<pre><code>TextureView
</code></pre>
<p>,</p>
<pre><code>SurfaceView
</code></pre>
<p>ä¸‰ç§æ–¹å¼è¿›è¡Œç»˜åˆ¶ï¼Œå…¶ä¸­</p>
<pre><code>TextureView
</code></pre>
<p>,</p>
<pre><code>SurfaceView
</code></pre>
<p>éƒ½æ˜¯é‡‡ç”¨</p>
<pre><code>lockCanvas()
</code></pre>
<p>çš„æ–¹å¼ï¼Œè¯¥æ–¹å¼æœ¬è´¨éƒ½æ˜¯å‘</p>
<pre><code>Surface
</code></pre>
<p>ç”³è¯·ä¸€å—Bufferï¼Œå†å‘Bufferå†™æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯è½¯ç»˜åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬é¡¹ç›®ä¸­å®é™…ä½¿ç”¨çš„æ˜¯åŸºäº</p>
<pre><code>View
</code></pre>
<p>çš„ç»˜åˆ¶æ–¹æ¡ˆã€‚æ¯æ¬¡æ·»åŠ å¼¹å¹•é¦–å…ˆä¼šå¤ç”¨ä¸€ä¸ªå¤§å°åˆé€‚(æ²¡æœ‰æ—¶åˆ›å»º)çš„Bitmap,ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹åˆ©ç”¨CPUå°†å¼¹å¹•å†…å®¹ç»˜åˆ¶åˆ°Bitmapä¸­ï¼Œç­‰åˆ°äº†ä¸Šå±çš„æ—¶æœºåˆ©ç”¨</p>
<pre><code>View
</code></pre>
<p>çš„</p>
<pre><code>onDraw(...)
</code></pre>
<p>è¿›è¡Œç»˜åˆ¶ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™éƒ½æ˜¯ä½¿ç”¨ç¡¬ä»¶ç»˜åˆ¶ï¼Œé‚£ä¹ˆè¿™ä¼šå­˜åœ¨ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸAndroidçš„Viewçš„ç¡¬ä»¶ç»˜åˆ¶çš„æµç¨‹æ˜¯åœ¨ä¸»çº¿ç¨‹æ„å»ºDisplay Listï¼Œç„¶ååœ¨Render Threadè¿›è¡ŒæŒ‡ä»¤åˆå¹¶ä¸æ‰§è¡Œçº¹ç†ä¸Šä¼ æ¸²æŸ“(OpenGL)ï¼Œåœ¨å¤§é‡å¼¹å¹•çš„æƒ…å†µä¸‹ä¼šå‡ºç°å¤§é‡çº¹ç†ä¸Šä¼ ï¼Œçº¹ç†ä¸Šä¼ è¿‡ç¨‹ä¸­é€šå¸¸ä¸»çº¿ç¨‹ä¼šwaitä¿è¯æ•°æ®ä¸€è‡´ï¼Œè¿™ä¼šå¯¼è‡´ä¸»çº¿çº¿å¡é¡¿å·²ç»ä»¥åŠRender Threadç»˜åˆ¶è¶…æ—¶ï¼Œå¦å¤–å¼¹å¹•å ç”¨çš„å†…å­˜æ˜¾å­˜ä¹Ÿæ˜¯éå¸¸çš„å¤§ã€‚ä¸ºæ­¤æˆ‘ä»¬å¸Œæœ›å¯ä»¥ä¼˜åŒ–å¡é¡¿ï¼Œå†…å­˜/æ˜¾å­˜çš„å ç”¨ã€‚ æ–°å¼¹å¹•ç»„ä»¶é‡‡ç”¨ä¸€å¼ Bitmapæ‰¿è½½å¤šæ¡å¼¹å¹•çš„æ–¹å¼ï¼Œå‡å°‘å¤šBitmapçº¹ç†ä¸Šä¼ çš„çš„æ¬¡æ•°ï¼Œåœ¨OpenGLä¸­æ¸²æŸ“æ¯ä¸€æ¡å¼¹å¹•çš„æ—¶å€™ï¼Œåœ¨ä»çº¹ç†ä¸­æ‰£å–æ¯æ¡å¼¹å¹•çš„ä½ç½®ä¿¡æ¯(çº¹ç†åæ ‡)è¿›è¡Œæ¸²æŸ“ã€‚è¦ä½¿ç”¨OpenGLæˆ‘ä»¬è€ƒè™‘ä½¿ç”¨TextureViewæˆ–æ˜¯SurfaceView(GLSurfaceView)ï¼Œç”±äºä¸šåŠ¡ä¸­å¼¹å¹•å¤„äºViewçš„ä¸­é—´å±‚ï¼ŒSurfaceViewæ— æ³•åµŒå…¥ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬ä¼šä½¿ç”¨TextureView(SurfaceViewç»˜åˆ¶ä¹Ÿå®ç°äº†)ã€‚ç”±äºä¸€æ‰¹å¼¹å¹•ç”Ÿæˆçš„BItmapå°ºå¯¸ç›¸å¯¹äºå•æ¡å¼¹å¹•å¤§äº†å¾ˆå¤šï¼Œæ‰€ä»¥åœ¨åšçº¹ç†ä¸Šä¼ çš„æ—¶å€™éœ€è¦è€ƒè™‘éæ¸²æŸ“çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œã€‚</p>
<p>!https://www.kutear.com/post-images/1584686473976.png</p>
<h1 id="ä¼˜åŒ–">ä¼˜åŒ–</h1>
<h2 id="åŠ¨æ€å¼¹å¹•çš„æ”¯æŒ">åŠ¨æ€å¼¹å¹•çš„æ”¯æŒ</h2>
<p>ä½¿ç”¨ä¸Šé¢çš„æ–¹æ¡ˆæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆæ‰€æœ‰é™æ€å¼¹å¹•çš„å±•ç¤ºï¼Œä½†æ˜¯ä¸šåŠ¡éœ€æ±‚ä¸­é€šå¸¸ä¼šå‡ºç°ä¸€äº›é«˜çº§å¼¹å¹•ï¼Œè¿™ç§å¼¹å¹•é€šå¸¸è‡ªèº«å°±å¸¦æœ‰åŠ¨æ•ˆ(æ¯”å¦‚èƒŒæ™¯æ˜¯å¼ webpç­‰åŠ¨å›¾)ï¼Œè¿™æ˜¯å¦‚æœè¿˜æ˜¯èµ°åŸºäºä¸€å¼ Bitmapçš„æ–¹æ¡ˆï¼Œå°±çš„å°†åŠ¨å›¾çš„æ¯ä¸€å¸§é¢„å…ˆç»˜åˆ¶åˆ°Bitmapå¹¶éœ€è¦è‡ªå·±æ§åˆ¶æ˜¾ç¤ºçš„æ—¶æœºï¼Œè¿™æ ·æ“ä½œè¿‡äºå¤æ‚ä¸”æ‰©å±•æ€§ä¸å¤Ÿï¼Œå› æ­¤æ’é™¤è¿™ä¸ªæ–¹æ¡ˆã€‚æˆ‘ä»¬é‡‡ç”¨æœ€ç›´æ¥æ–¹å¼-æ”¯æŒViewæ’å…¥åˆ°å¼¹å¹•ç³»ç»Ÿä¸­ï¼Œè¿™æ ·æˆ‘ä»¬ä¸éœ€è¦æ§åˆ¶Viewçš„å†…å®¹åˆ°åº•æ˜¯æ€æ ·ä¸ªåŠ¨æ³•ï¼Œæˆ‘ä»¬åªå…³å¿ƒä»–åœ¨æ•´ä¸ªå¼¹å¹•ç³»ç»Ÿä¸­çš„ä½ç½®ï¼Œæˆ‘ä»¬çš„æ’ç‰ˆé€»è¾‘ä¾æ—§æ˜¯å¯ç”¨çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ç§å±•ç¤ºæ–¹å¼ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†å¼¹å¹•å±•ç¤ºåˆ†ä¸ºé™æ€å¼¹å¹•å±•ç¤ºå±‚ä¸åŠ¨æ€å¼¹å¹•å±•ç¤ºå±‚ã€‚</p>
<h2 id="å†…å­˜æ˜¾å­˜çš„å ç”¨">å†…å­˜/æ˜¾å­˜çš„å ç”¨</h2>
<p>ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆå®ç°å¼¹å¹•ç»„ä»¶ä¹‹åï¼ŒFPSä»¥åŠCPUçš„å ç”¨ä¸Šé¢éƒ½ä¼˜äºBç«™å¼¹å¹•åº“ï¼Œä½†æ˜¯åœ¨æ˜¾å­˜çš„å ç”¨ä¸Šé¢å´æ¯”Bç«™å¼¹å¹•å¤šå‡ºä¸€éƒ¨åˆ†ã€‚</p>
<p>!https://www.kutear.com/post-images/1584672574953.png</p>
<p>ä¸»è¦å¤šå‡ºæ¥æ˜¾å­˜å¼€é”€å…¶å®æ¥æºäºTextureViewè‡ªèº«ç¯å¢ƒçš„å¼€é”€ï¼ŒTextureViewè¿è¡Œä¼šåˆ›å»ºSurface,Surfaceæœ‰ä¸€ä¸ªåŒç¼“å†²æˆ–ä¸‰ç¼“å†²çš„Buffer,ä»–çš„å¤§å°å’ŒTextureViewçš„å¤§å°ä»¥åŠBufferçš„æ•°é‡æœ‰å…³ï¼Œå¯ä»¥ä½¿ç”¨</p>
<pre><code>adb shell dumpsys meminfo pkg
</code></pre>
<p>æ¥è¿›è¡ŒæŸ¥çœ‹(ä¸‹å›¾ä¸­çš„</p>
<pre><code>EGL mtrack
</code></pre>
<p>)ï¼Œè¿™ä¸ªå€¼åˆå§‹åŒ–å¥½ä¹‹åå°±æ˜¯å›ºå®šçš„ï¼Œå¯¹äºæˆ‘ä»¬ä¸šåŠ¡ä¾§å¾ˆéš¾å»å‡å°‘è¿™å—æ˜¾å­˜çš„å ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¼˜åŒ–ä¸»è¦éƒ½é›†ä¸­åœ¨æˆ‘ä»¬è‡ªå·±çš„çº¹ç†/å†…å­˜ä¸Šé¢ã€‚</p>
<h3 id="bitmapå¡«å……ç‡">Bitmapå¡«å……ç‡</h3>
<p>æˆ‘ä»¬é‡‡ç”¨ä¸€å¼ å¤§çš„Bitmapç»˜åˆ¶å¼¹å¹•ï¼Œé‚£ä¹ˆè¿™å¼ Bitmapçš„åˆ©ç”¨ç‡æ˜¯éå¸¸é‡è¦çš„ï¼Œä»–ä¸ä»…å½±å“åœ¨nativeçš„å¤§å°ï¼Œæ›´é‡è¦çš„æ˜¯å½±å“æ˜¾å­˜ï¼Œæ¯•ç«Ÿæ˜¾å­˜å ç”¨æ˜¯æˆ‘ä»¬éœ€è¦çªç ´çš„ä¸€ä¸ªç‚¹ã€‚æˆ‘ä»¬éœ€è¦æ¯ä¸€æ‰¹å¼¹å¹•è¿‘å¯èƒ½çš„å ç”¨æ›´å°çš„Bitmap(Bitmapçš„åˆ©ç”¨ç‡æå‡)ï¼Œè€ƒè™‘åˆ°Bitmapçš„å¤ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ°å¥½åˆé€‚çš„Bitmapï¼Œæˆ‘ä»¬å¯¹é€‰å–çš„Bitmapçš„å°ºå¯¸è¿›è¡Œç†åˆåˆ°å¤šä¸ªå°ºå¯¸ä¸Šã€‚</p>
<h3 id="çº¹ç†ä¸Šä¼ æ—¶æœºé€‰æ‹©">çº¹ç†ä¸Šä¼ æ—¶æœºé€‰æ‹©</h3>
<p>å› ä¸ºå¼¹å¹•é¢„æ’ç‰ˆçš„ç¼˜æ•…ï¼Œä¸€æ‰¹å¼¹å¹•æ·»åŠ åˆ°ç³»ç»Ÿå¯èƒ½è¢«æ’åœ¨ç¦»å±Mçš„ä½ç½®ï¼Œåœ¨è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¾æ—§æŠŠå®ƒç»˜åˆ¶åˆ°Bitmapä¸Šé¢å¹¶è¿›è¡Œäº†çº¹ç†çš„ä¸Šä¼ ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å…¶å®æ²¡æœ‰è¿™ä¸ªå¿…è¦ï¼Œå› ä¸ºè¿™æ‰¹å¼¹å¹•è¿™ä¸ªæ—¶å€™å¹¶æ²¡æœ‰éœ€è¦ä¸Šå±æ¸²æŸ“ï¼Œè¿˜éœ€è¦ï¼ˆM/V)çš„æ—¶é—´æ‰ä¼šå‡ºç°åœ¨å±å¹•ä¹‹ä¸Šï¼Œè¿™æ—¶ç»˜åˆ¶å’Œä¸Šä¼ ä¹‹åï¼Œè¿™ä¸ªçº¹ç†çš„å­˜æ´»å‘¨æœŸè¢«æ‹‰é•¿äº†ï¼Œå¯¼è‡´ä¸€å®šæ—¶é—´å†…å­˜åœ¨çš„çº¹ç†çš„æ•°é‡å¢åŠ ã€‚  æœ‰äº†è¿™ä¸ªæƒ³æ³•ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹Bitmapç»˜åˆ¶å’Œçº¹ç†ä¸Šä¼ çš„æ—¶æœºï¼ŒæŠŠè¿™ä¸ªè¿‡ç¨‹ç§»åˆ°è¯¥æ‰¹å¼¹å¹•å¿«è¦ä¸Šå±çš„æ—¶åˆ»åœ¨æ‰§è¡Œï¼Œè¿™ä¸ªå…·ä½“çš„é˜ˆå€¼è·ç¦»å¯ä»¥åœ¨è¿è¡Œä¸­ç»Ÿè®¡Bitmapç»˜åˆ¶+çº¹ç†ä¸Šä¼ çš„æ—¶é—´æ¥è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œåªè¦åœ¨ä¿è¯åˆ°è¾¾å±å¹•è¾¹ç¼˜çš„æ—¶å€™å¯ä»¥æœ‰çº¹ç†å¯ç”¨å°±è¡Œã€‚</p>
<h3 id="é‡å¤å¼¹å¹•å¤ç”¨">é‡å¤å¼¹å¹•å¤ç”¨</h3>
<p>åœ¨ç›´æ’­åœºæ™¯ä¸­ç»å¸¸ä¼šå‡ºç°åŒä¸€æ—¶åˆ»å‡ºç°å¾ˆå¤šç›¸åŒå¼¹å¹•çš„åœºæ™¯(æ¸¸æˆèƒœåˆ©/æŠ½å¥–)ï¼Œå¼¹å¹•é‡å¤§å¹¶ä¸”å¼¹å¹•çš„å†…å®¹ç›¸åŒï¼Œè¿™æ˜¯å¦‚æœä¾ç„¶æŠŠæ¯æ¡å¼¹å¹•ç»˜åˆ¶åˆ°Bitmapä¸Šå†è¿›è¡Œä¸Šä¼ å±•ç¤ºå°†æµªè´¹CPUå†…å­˜æ˜¾å­˜èµ„æºã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¤ç”¨ç›¸åŒå¼¹å¹•ï¼Œå¯¹äºç›¸åŒçš„å¼¹å¹•æˆ‘ä»¬åªåœ¨Bitmapä¸Šé¢ç»˜åˆ¶ä¸€æ¬¡ï¼Œå…¶ä»–ç›¸åŒçš„å¼¹å¹•éƒ½å¼•ç”¨è¿™åŒä¸€å—åŒºåŸŸï¼Œç„¶ååœ¨OpenGLç»˜åˆ¶çš„æ—¶å€™ï¼Œåœ¨æ ¹æ®çº¹ç†åæ ‡ç»˜åˆ¶å¤åŸå‡ºå¤šæ¡å¼¹å¹•ã€‚å½“ç„¶ï¼Œåœ¨æ­¤åŸºç¡€ä¹‹åï¼Œè¿˜å¯ä»¥åšâ€œå­åºåˆ—â€ç±»å‹çš„å¼¹å¹•å¤ç”¨ï¼Œä¸è¿‡å®ç°ç›¸å¯¹éº»çƒ¦ï¼Œæ²¡æœ‰å®ç°ã€‚</p>
<h3 id="bitmapé€šé“å¤ç”¨">Bitmapé€šé“å¤ç”¨</h3>
<p>åœ¨é‡‡ç”¨ äº†ä»¥ä¸Šæ–¹æ¡ˆä¹‹åï¼Œå¯ä»¥ç¼“è§£éƒ¨åˆ†é—®é¢˜ï¼Œæ˜¯å¦è¿˜å­˜åœ¨æ›´å¤§çš„ä¼˜åŒ–ç©ºé—´å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬æƒ³åˆ°æ˜¯å¦å¯ä»¥é‡‡ç”¨åªåœ¨Bitmapä¸Šé¢ç»˜åˆ¶é€æ˜åº¦ï¼Œå°†å…·ä½“çš„ç€è‰²çš„æ•ˆæœäº¤ç”±Shaderå®Œæˆï¼Œè¿™æ ·æˆ‘ä»¬åœ¨Bitmapçš„åˆ›å»ºä»¥åŠçº¹ç†çš„ä¸Šä¼ åªéœ€è¦åªæœ‰é€æ˜é€šé“çš„Bitmapï¼Œè¿™æ ·ç†è®ºä¸Šå†…å­˜/æ˜¾å­˜å¤§å°å¯ä»¥é™ä½åˆ°åŸæ¥çš„4å€(é‡‡ç”¨ARGB_4444çš„ä¹Ÿä¼šè¢«å¼ºåˆ¶è½¬ä¸ºARGB_8888)ï¼Œä½†æ˜¯é‡‡ç”¨å•ä¸ªé€æ˜é€šé“ç»˜åˆ¶å‡ºæ¥çš„å¤šé¢œè‰²å¼¹å¹•(å¦‚å¼¹å¹•ä¸­å«æœ‰è¡¨æƒ…ğŸ˜Š)çš„å½©è‰²ä¿¡æ¯ä¼šè¢«ä¸¢å¼ƒæ‰ã€‚ä¸ºæ­¤æˆ‘ä»¬è¿˜æ˜¯é€‰æ‹©ARGB4é€šé“çš„Bitmapæ¥è¿›è¡Œç»˜åˆ¶ï¼Œå¯¹äºå¤šé¢œè‰²å¼¹å¹•è¿˜æ˜¯æŒ‰ç…§æ™®é€šçš„ç»˜åˆ¶æ–¹æ¡ˆï¼Œå¯¹äºå•ä¸€é¢œè‰²çš„å¼¹å¹•æˆ‘ä»¬å°†ä»–çš„é€æ˜åº¦é€å°„åˆ°ARGBä¸­çš„ä¸€ä¸ªé€šé“ã€‚ç»è¿‡å¯¹æˆ‘ä»¬å¤–ç½‘å¼¹å¹•çš„åˆ†æï¼Œå¤§çº¦</p>
<pre><code>70%
</code></pre>
<p>çš„å¼¹å¹•éƒ½å±äºå•ä¸€é¢œè‰²å¼¹å¹•ï¼Œä¸ºæ­¤ç†æƒ³æƒ…å†µä¸‹ä¼šæœ‰å‡å°‘</p>
<p><strong>3å€</strong></p>
<p>ä»¥ä¸Šçš„å†…å­˜æ˜¾å­˜å ç”¨(0.3 * 1 + 0.7 * 4)ã€‚ å¦‚ä½•æ‰èƒ½å®ç°ä¸åŒå¼¹å¹•åœ¨åŒä¸€åƒç´ ä¸Šçš„ä¸åŒé€šé“å‘¢ï¼Œå…¶å®Androidå·²ç»å·²ç»æœ‰ç›¸å…³çš„æ–¹æ¡ˆï¼Œåœ¨ç»˜åˆ¶Bitmapçš„æ—¶å€™é€šè¿‡ç»™paintè®¾ç½®</p>
<pre><code>Xfermode
</code></pre>
<p>å¯ä»¥å®ç°ä¸åŒçš„å åŠ æ•ˆæœï¼Œå¯»æ‰¾ä¸€åœˆå°±ä¼šå‘ç°</p>
<p><a href="https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html#ADD">PorterDuff.Mode.ADD</a></p>
<p>åŸºæœ¬æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>!https://www.kutear.com/post-images/1584674381264.png</p>
<p>å¯¹äºä¸¤æ¬¡å åŠ ä»–çš„Alphaé€šé“å’ŒColoré€šé“éƒ½å–å€¼å¤§çš„ï¼Œä½†åœ¨å®é™…æ“ä½œä¸­å‘ç°å¯¹äºå…¨é€æ˜çš„æƒ…å†µæ˜¯ä¼šè¢«å¿½ç•¥æ‰ï¼Œæ¯”å¦‚(FF000000å’Œ00FF0000å åŠ è¿˜æ˜¯FF000000ï¼Œä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„FFFF0000)ï¼Œæ‰€ä»¥Alphaé€šé“çš„å¤ç”¨è¡Œä¸é€šï¼Œéƒ½å¾—å¡«å……FFã€‚åŸºäºè¿™ä¸ªæ ·çš„æ“ä½œï¼Œæˆ‘ä»¬å°†å¼¹å¹•åŸæœ¬çš„Alphaé€šé“ç»˜åˆ¶åˆ°Bitmapçš„RGBé€šé“ä¹‹ä¸€ä¸­å»ï¼Œå°±å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„Bitmapã€‚</p>
<p>!https://www.kutear.com/post-images/1584670990231.png</p>
<p>ä½¿ç”¨å·¥å…·åˆ†ç¦»å‡ºARGBå„è‡ªçš„ä¿¡æ¯ï¼Œå¯ä»¥å¾—åˆ°å„ä¸ªé€šé“çš„å›¾åƒä¿¡æ¯ã€‚</p>
<p>!https://www.kutear.com/post-images/1584704657139.png</p>
<p>æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨Shaderä¸­å°±å¯ä»¥åˆ©ç”¨å¼¹å¹•çš„çœŸæ­£é¢œè‰²(RGB)å’Œçº¹ç†ä¸­çš„æŸä¸ªé€šé“(A)åˆå¹¶æˆåƒç´ ç‚¹çš„çœŸå®é¢œè‰²ä¿¡æ¯ã€‚ æ³¨ï¼šè¯¥å®ç°å› ä¸ºBitmapçš„Alphaé€šé“æ— æ³•ä½¿ç”¨ï¼Œä¸èƒ½ç»™å¼¹å¹•æ·»åŠ é˜´å½±æ•ˆæœï¼Œå¦‚æœæœ‰é˜´å½±ä¼šé€€åŒ–æˆå¤šé¢œè‰²å¼¹å¹•å¤„ç†ã€‚</p>
<h1 id="åè®°">åè®°</h1>
<p>åšäº†è¿™äº›å†…å­˜/æ˜¾å­˜ä¸Šçš„ä¼˜åŒ–ï¼Œåœ¨å¼¹å¹•é‡å¤§çš„æƒ…å†µä¸‹ï¼Œæ˜¾å­˜çš„å ç”¨å·²ç»ä½äºBç«™å¼¹å¹•ï¼Œä½†åœ¨å°‘æ•°å¼¹å¹•çš„åœºæ™¯ä¾ç„¶æœ‰æ”¹è¿›ç©ºé—´ï¼Œåœ¨å¼¹å¹•é‡å°‘çš„æƒ…å†µä¸‹ï¼Œå¼¹å¹•æœ¬èº«å°±ä¸å¯èƒ½é“ºæ»¡å…¨å±ï¼Œå¯ä»¥é‡‡ç”¨å¯ä»¥é€šè¿‡å‡å°‘Surfaceçš„é»˜è®¤é«˜åº¦æ¥è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¸ªæ–¹æ¡ˆåˆæ­¥éªŒè¯æ˜¯å¯ä»¥é™ä½<code>EGL mtrack</code>çš„å¤§å°ï¼Œåé¢ä¼šç»§ç»­æ¢ç´¢ã€‚</p>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<ul>
<li><a href="https://github.com/bilibili/DanmakuFlameMaster">bilibili/DanmakuFlameMaster</a></li>
<li><a href="https://developer.android.com/reference/android/graphics/PorterDuff.Mode.html">PorterDuff.Mode</a></li>
</ul>
<h1 id="é™„å½•">é™„å½•</h1>
<ul>
<li>imagemagickåˆ†ç¦»ARGBä¸ºç‹¬ç«‹å›¾ç‰‡ <code>shell convert input.png -channel RGBA -separate channels_%d.png</code></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android ADB å®‰è£…è¿‡ç¨‹]]></title>
        <id>https://www.kutear.com/post/android-adb-an-zhuang-guo-cheng/</id>
        <link href="https://www.kutear.com/post/android-adb-an-zhuang-guo-cheng/">
        </link>
        <updated>2017-03-12T12:48:25.000Z</updated>
        <content type="html"><![CDATA[<h1 id="è¡¨çš®">è¡¨çš®</h1>
<p>ç³»ç»Ÿé»˜è®¤çš„å®‰è£…å™¨<a href="https://android.googlesource.com/platform/packages/apps/PackageInstaller/+/marshmallow-release/src/com/android/packageinstaller/PackageInstallerActivity.java">com/android/packageinstaller/PackageInstallerActivity.java</a>ã€‚</p>
<p>ç‚¹å‡»å®‰è£…ä¼šæ‰§è¡Œ</p>
<pre><code class="language-java">    private void startInstall() {        // Start subactivity to actually install the application        Intent newIntent = new Intent();        newIntent.putExtra(PackageUtil.INTENT_ATTR_APPLICATION_INFO,                mPkgInfo.applicationInfo);        newIntent.setData(mPackageURI);        newIntent.setClass(this, InstallAppProgress.class);        newIntent.putExtra(InstallAppProgress.EXTRA_MANIFEST_DIGEST, mPkgDigest);        newIntent.putExtra(                InstallAppProgress.EXTRA_INSTALL_FLOW_ANALYTICS, mInstallFlowAnalytics);        String installerPackageName = getIntent().getStringExtra(                Intent.EXTRA_INSTALLER_PACKAGE_NAME);        if (mOriginatingURI != null) {            newIntent.putExtra(Intent.EXTRA_ORIGINATING_URI, mOriginatingURI);        }        if (mReferrerURI != null) {            newIntent.putExtra(Intent.EXTRA_REFERRER, mReferrerURI);        }        if (mOriginatingUid != VerificationParams.NO_UID) {            newIntent.putExtra(Intent.EXTRA_ORIGINATING_UID, mOriginatingUid);        }        if (installerPackageName != null) {            newIntent.putExtra(Intent.EXTRA_INSTALLER_PACKAGE_NAME,                    installerPackageName);        }        if (getIntent().getBooleanExtra(Intent.EXTRA_RETURN_RESULT, false)) {            newIntent.putExtra(Intent.EXTRA_RETURN_RESULT, true);            newIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT);        }        if(localLOGV) Log.i(TAG, &quot;downloaded app uri=&quot;+mPackageURI);        startActivity(newIntent);        finish();    }
</code></pre>
<p>å¯åŠ¨<code>InstallAppProgress.java</code>ä¼šæ‰§è¡Œ</p>
<pre><code class="language-java">PackageManager pm = getPackageManager();//originatingUidä¸ºå‘èµ·å®‰è£…çš„appçš„uid//originatingURI,referrerä¹Ÿéƒ½æ˜¯æ ‡è¯†å®‰è£…çš„å‘èµ·è€…VerificationParams verificationParams = new VerificationParams(null, originatingURI,                referrer, originatingUid, manifestDigest);pm.installPackageWithVerificationAndEncryption(mPackageURI, observer, installFlags,                    installerPackageName, verificationParams, null);
</code></pre>
<p>ä¸Šé¢ä»£ç æˆ‘ä»¬å¤§æ¦‚è¿‡ä¸€ä¸‹çŸ¥é“<code>mPackageURI</code>æ˜¯APKçš„è·¯å¾„ï¼Œ<code>observer</code>æ˜¯è§‚å¯ŸAPKå®‰è£…çš„ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œ<code>installFlag</code>è®¾ç½®å®‰è£…æ ‡è®°ï¼Œæ¯”å¦‚replaceå·²æœ‰çš„APK,<code>installerPackageName</code>å¤§æ¦‚æ˜¯å‘èµ·å®‰è£…çš„APKçš„çš„appçš„åŒ…å(å¾…ç¡®è®¤)ã€‚</p>
<h1 id="æ ¸å¿ƒ">æ ¸å¿ƒ</h1>
<p>ä¸‹æ–‡åŸºäºandroid-sdk-23ã€‚</p>
<p>åˆ°æ­¤æˆ‘ä»¬è¿›å…¥Androidæ ¸å¿ƒä¹‹ä¸€çš„<code>PackageManager</code>ã€‚ä»‹äºä¹‹å‰å¯¹Androidç³»ç»Ÿçº§<code>Manager</code>çš„äº†è§£ï¼Œ <code>PackageManager</code>çš„å­ç±»<code>ApplicationPackageManager</code>å…¶å®å¼•ç”¨çš„æ˜¯ä¸€ä¸ª<code>IPackageManager</code>,è€Œ<code>IPackageManager</code>çš„å®ç°å°±æ˜¯<code>PackageManagerService</code>(ä»¥ä¸‹ç®€ç§°<code>PMS</code>)ï¼Œåœ¨å‡½æ•°<code>installPackageWithVerificationAndEncryption()</code>ä¸­å®é™…ä¸Šè°ƒç”¨äº†<code>PMS</code>çš„<code>installPackage(...)</code>å‡½æ•°ã€‚</p>
<pre><code class="language-java">installPackage(String originPath, IPackageInstallObserver2 observer,int installFlags, String installerPackageName,VerificationParams verificationParams,String packageAbiOverride)
</code></pre>
<p>è¿™ä¸ªå‡½æ•°çš„é€»è¾‘åŒ…æ‹¬ä»¥ä¸‹å‡ éƒ¨åˆ†é€»è¾‘</p>
<ol>
<li>æ£€æŸ¥å½“å‰ä½¿è®¾å¤‡çš„äººæ˜¯å¦æ‹¥æœ‰å®‰è£…apkçš„æƒé™ï¼Œæ£€æŸ¥è°ƒç”¨å®‰è£…apkçš„ç¨‹åºæ˜¯å¦å«æœ‰å®‰è£…apkçš„æƒé™ã€‚</li>
<li>ä½¿ç”¨<code>UserHandle</code>æŒ‡ç¤ºå®‰è£…çš„apkå½’å±äºå“ªä¸€ä¸ªç”¨æˆ·ã€‚</li>
<li>ä½¿ç”¨<code>Handler</code>å‘é€ä¸€ä¸ª<code>INIT_COPY</code>çš„æ¶ˆæ¯ã€‚</li>
</ol>
<p><code>INIT_COPY</code>ä¸­æŠŠ<code>InstallParams</code>(æŒæœ‰å¾…å®‰è£…appçš„ä¿¡æ¯)å­˜å…¥ä¸€ä¸ªåˆ—è¡¨,ç„¶ååœ¨å‘é€å¦å¤–ä¸€ä¸ªæ¶ˆæ¯<code>MCS_BOUND</code>ã€‚åœ¨<code>MCS_BOUND</code>ä¸­ä¼šä»ä¸Šæ–‡ä¸­å­˜æ”¾<code>InstallParams</code>çš„åˆ—è¡¨ä¸­ä¾æ¬¡å–å‡ºå¾…å®‰è£…apkçš„éƒ¨åˆ†ä¿¡æ¯ã€‚å¯¹äºä¾æ¬¡å–å‡ºçš„<code>InstallParams</code>åœ¨æ‰§è¡Œå‡½æ•°<code>InstallParams#startCopy()</code>,åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šè¿›è¡Œ<code>media container service</code>ç»‘å®šï¼Œå¦‚æœå¤šæ¬¡(4æ¬¡)å°è¯•ç»‘å®šéƒ½å¤±è´¥çš„è¯ï¼Œå°±è¡¨ç¤ºå®‰è£…å¤±è´¥ï¼Œé€€å‡ºï¼Œå¦åˆ™æ‰§è¡Œå‡½æ•°<code>InstallParams#handleStartCopy()</code>,<code>handleStartCopy()</code>æ–¹æ³•å¾ˆé•¿,å®ƒçš„é€»è¾‘åŒ…å«ä»¥ä¸‹å‡ ç‚¹</p>
<ol>
<li>åˆ¤æ–­å®‰è£…ä½ç½®ï¼Œæ ¹æ®<code>DefaultContainerServie#getMinimalPackageInfo()</code>è·å–æ¨èä½ç½®</li>
<li>åˆ¤æ–­/data/appç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦åˆ™é‡Šæ”¾cacheåœ¨å°è¯•</li>
<li>å¦‚æœå¯åŠ¨äº†åŒ…éªŒè¯çš„è¯ï¼Œå°±ä¼šè¿›å…¥éªŒè¯é˜¶æ®µ</li>
<li>æ²¡æœ‰å¯åŠ¨éªŒè¯æˆ–éªŒè¯é€šè¿‡è¿›å…¥<code>InstallArgs#copyApk(...)</code></li>
</ol>
<p>è¿™é‡Œ<code>copyApk(...)</code>çš„ä½œç”¨å¤§è‡´æ˜¯</p>
<ol>
<li>é¦–å…ˆmInstallerService.allocateStageDirLegacyç”³è¯·è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼ˆdata/app/vmdl
<ul>
<li>**.tmpç›®å½•ï¼‰</li>
</ul>
</li>
<li>å¾—åˆ°ç”³è¯·çš„é‚£éƒ¨åˆ†ç©ºé—´çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶ä¸”ä¿®æ”¹æƒé™</li>
<li>IMediaContainerService#copyPackage æ‹·è´åˆ°æŒ‡å®šç›®å½•ï¼Œå®ç°åœ¨DefaultContainerServiceä¸­</li>
<li>NativeLibraryHelper#copyNativeBinariesWithOverride æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶(soåº“)</li>
</ol>
<p>!http://kutear.qiniudn.com/2017/02/21/fc925c470b4d9785e69c8aebf1c387d9.png</p>
<p>åˆ°æ­¤appçš„æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°äº†<code>data/app/vmdl***.tmp</code>ç›®å½•ä¸‹ã€‚æ­¤æ—¶çš„ç›®å½•ç»“æ„å¤§è‡´å¦‚ä¸‹</p>
<pre><code>data/app/vmdl***.tmp/
                    /base.apk
                    /split_***.apk  ???
                    /lib
                       /lib***.so
</code></pre>
<p>åœ¨å‡½æ•°<code>InstallParams#handleStartCopy()</code>ä¹‹åï¼Œæ˜¯æ‰§è¡Œå‡½æ•°<code>InstallParams#handleReturnCode()</code> ï¼Œè¿™ä¸ªå‡½æ•°çš„é€»è¾‘ä¸»è¦åŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š</p>
<ol>
<li>å®‰è£…Appä¹‹å‰çš„æ“ä½œï¼ˆ<code>InstallArgs#doPreInstall(...)</code>ï¼‰</li>
<li>å®‰è£…App(<code>installPackageLI(...)</code>)</li>
<li>å®‰è£…Appä¹‹åçš„æ“ä½œ(<code>InstallArgs#doPostInstall(res.returnCode, res.uid);</code>)</li>
<li>å¤‡ä»½æ“ä½œ</li>
</ol>
<p>å®‰è£…ä¹‹å‰ä¸»è¦æ˜¯å¤„ç†æ¸…ç†å·¥ä½œï¼Œåˆ é™¤ä¸€äº›æ–‡ä»¶ç›®å½•ã€‚</p>
<p>// TODO</p>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<ul>
<li><a href="http://blog.csdn.net/singwhatiwanna/article/details/19578947">Androidå†…æ ¸è§£è¯»-åº”ç”¨çš„å®‰è£…è¿‡ç¨‹</a></li>
<li><a href="https://guolei1130.github.io/2017/01/04/Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E7%9A%84/">Androidåº”ç”¨ç¨‹åºæ˜¯å¦‚ä½•å®‰è£…çš„</a></li>
<li><a href="http://www.ieveryday.pub/index.php/Andriod_Framework_Work_Note_Url_6">ä½¿ç”¨PackageInstallerå®‰è£…appæµç¨‹å­¦ä¹ å°ç»“</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Android View äº‹ä»¶å¤„ç†]]></title>
        <id>https://www.kutear.com/post/android-view-shi-jian-chu-li/</id>
        <link href="https://www.kutear.com/post/android-view-shi-jian-chu-li/">
        </link>
        <updated>2016-03-12T12:49:51.000Z</updated>
        <content type="html"><![CDATA[<p>@Override    public boolean dispatchTouchEvent(MotionEvent ev) {        if (mInputEventConsistencyVerifier != null) {            mInputEventConsistencyVerifier.onTouchEvent(ev, 1);        }        // If the event targets the accessibility focused view and this is it, start        // normal event dispatch. Maybe a descendant is what will handle the click.        if (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) {            ev.setTargetAccessibilityFocus(false);        }        boolean handled = false;        //å½“Viewè¢«é®æŒ¡æ—¶æ˜¯å¦ç»§ç»­äº‹ä»¶åˆ†å‘        if (onFilterTouchEventForSecurity(ev)) {            final int action = ev.getAction();            final int actionMasked = action &amp; MotionEvent.ACTION_MASK;//ACTION_MASK = 0xff            // Handle an initial down.            //ä¸€ä¸ªäº‹ä»¶æ—¶æœ‰DOWNå¼€å§‹,ç»è¿‡æ— æ•°çš„MOVE,æœ€åä»¥UPç»“æŸ            //æ‰€ä»¥å¦‚æœä¸ºDOWN,å°±åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œ            if (actionMasked == MotionEvent.ACTION_DOWN) {                // Throw away all previous state when starting a new touch gesture.                // The framework may have dropped the up or cancel event for the previous gesture                // due to an app switch, ANR, or some other state change.                //æŠŠä¸Šä¸€ä¸ªäº‹ä»¶å–æ¶ˆ,å³å‘é€Actionä¸ºACTION_CANCELçš„äº‹ä»¶ç»™mFirstTouchTargetè¿™ä¸ªé“¾è¡¨ä¸Šçš„View                //å¹¶ä¸”æ¸…ç©ºmFirstTouchTargetä¸Šçš„View,å› ä¸ºæ–°çš„äº‹ä»¶æ¥äº†,è¦é‡ç½®æ¥å—çš„View                cancelAndClearTouchTargets(ev);                resetTouchState();            }            // Check for interception.            //åˆ¤æ–­æ˜¯å¦è¦æ‹¦æˆªäº‹ä»¶,å³æ˜¯å¦åˆ†å‘ç»™Child View            final boolean intercepted;            if (actionMasked == MotionEvent.ACTION_DOWN                    || mFirstTouchTarget != null) {                      //requestDisallowInterceptTouchEvent(true)æ—¶ ---&gt; disallowIntercept = true                final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;                if (!disallowIntercept) {                    intercepted = onInterceptTouchEvent(ev);                    ev.setAction(action); // restore action in case it was changed                } else {                    intercepted = false;                }            } else {                // There are no touch targets and this action is not an initial down                // so this view group continues to intercept touches.                intercepted = true;            }            //å¦‚æœintercepted = true,æ„å‘³ç€ViewGroupæ‹¦æˆªäº†è¯¥äº‹ä»¶,é‚£ä¹ˆChild Viewå°†ä¸ä¼šæ”¶åˆ°è¯¥äº‹ä»¶            //åä¹‹Child Viewå¯ä»¥æ”¶åˆ°äº‹ä»¶            // If intercepted, start normal event dispatch. Also if there is already            // a view that is handling the gesture, do normal event dispatch.            if (intercepted || mFirstTouchTarget != null) {                ev.setTargetAccessibilityFocus(false);            }            // Check for cancelation.            //æ£€æŸ¥æ˜¯å¦è¿™ä¸ªäº‹ä»¶å·²ç»è¢«å–æ¶ˆ            final boolean canceled = resetCancelNextUpFlag(this)                    || actionMasked == MotionEvent.ACTION_CANCEL;            // Update list of touch targets for pointer down, if needed.            // é»˜è®¤ä¸º<code>true</code>ï¼Œåˆ†å‘ç»™å¤šä¸ª<code>View</code>ï¼ˆæ¯”å¦‚å‡ ä¸ªå­<code>View</code>ä½ç½®é‡å ï¼‰            final boolean split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != 0;            TouchTarget newTouchTarget = null;            boolean alreadyDispatchedToNewTouchTarget = false;            //äº‹ä»¶æ²¡æœ‰è¢«å–æ¶ˆ,å¹¶ä¸”å½“å‰ViewGroupæ²¡æœ‰æ‹¦æˆªè¯¥äº‹ä»¶,            //é‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„åˆ†å‘è¿‡ç¨‹            if (!canceled &amp;&amp; !intercepted) {                // If the event is targeting accessiiblity focus we give it to the                // view that has accessibility focus and if it does not handle it                // we clear the flag and dispatch the event to all children as usual.                // We are looking up the accessibility focused host to avoid keeping                // state since these events are very rare.                View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()                        ? findChildWithAccessibilityFocus() : null;                //è¿™é‡Œç‰¹åˆ«æ³¨æ„,åªæœ‰åœ¨DOWNçš„æ—¶å€™ä¼šæ‰§è¡Œ,ä¹Ÿå°±æ˜¯å¹³æ—¶æˆ‘ä»¬çŸ¥é“çš„                //ä¹‹ååœ¨å¯¹DOWNäº‹ä»¶åšäº†å¤„ç†(æ‹¦æˆª),åœ¨ä»¥åçš„äº‹ä»¶åºåˆ—æˆ‘ä»¬æ‰å¯ä»¥æ”¶çš„åˆ°,                //å› ä¸ºåç»­çš„äº‹ä»¶ä¸ä¼šå†åˆ¤æ–­å“ªäº›childä¼šå¤„ç†è¯¥äº‹ä»¶,è€Œä»…ä»…æ˜¯é€šè¿‡DOWNæ˜¯                //ä¿å­˜åœ¨mFirstTouchTargetä¸­çš„æ•°æ®æ¥åˆ†å‘,ä¸å†mFirstTouchTargetå½“ç„¶ä¹Ÿå°±                //ä¸èƒ½æ¥æ”¶åˆ°äº‹ä»¶äº†                //ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœViewGroupçš„æŸä¸ªå­©å­æ²¡æœ‰æ¥å—ACTION_DOWNäº‹ä»¶ï¼›é‚£ä¹ˆï¼Œ                //ACTION_MOVEå’ŒACTION_UPç­‰äº‹ä»¶ä¹Ÿä¸€å®šä¸ä¼šåˆ†å‘ç»™è¿™ä¸ªå­©å­ï¼                if (actionMasked == MotionEvent.ACTION_DOWN                        || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)                        || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {                    //è·å–touch äº‹ä»¶çš„index                    final int actionIndex = ev.getActionIndex(); // always 0 for down                    //ev.getPointerId() ==&gt;                    //* Return the pointer identifier associated with a particular pointer                    //* data index is this event.  The identifier tells you the actual pointer                    //* number associated with the data, accounting for individual pointers                    //* going up and down since the start of the current gesture.                    final int idBitsToAssign = split ? 1 &lt;&lt; ev.getPointerId(actionIndex)                            : TouchTarget.ALL_POINTER_IDS;                    // Clean up earlier touch targets for this pointer id in case they                    // have become out of sync.                    removePointersFromTouchTargets(idBitsToAssign);                    final int childrenCount = mChildrenCount;                    if (newTouchTarget == null &amp;&amp; childrenCount != 0) {                        final float x = ev.getX(actionIndex); //è¿”å›Xæ–¹å‘åæ ‡                        final float y = ev.getY(actionIndex);                        // Find a child that can receive the event.                        // Scan children from front to back.                        final ArrayList<View> preorderedList = buildOrderedChildList();                        final boolean customOrder = preorderedList == null                                &amp;&amp; isChildrenDrawingOrderEnabled();                        final View[] children = mChildren;                        for (int i = childrenCount - 1; i &gt;= 0; i--) {                            final int childIndex = customOrder                                    ? getChildDrawingOrder(childrenCount, i) : i;                            final View child = (preorderedList == null)                                    ? children[childIndex] : preorderedList.get(childIndex);                            // If there is a view that has accessibility focus we want it                            // to get the event first and if not handled we will perform a                            // normal dispatch. We may do a double iteration but this is                            // safer given the timeframe.                            if (childWithAccessibilityFocus != null) {                                if (childWithAccessibilityFocus != child) {                                    continue;                                }                                childWithAccessibilityFocus = null;                                i = childrenCount - 1;                            }                            //è¯¥Viewä¸èƒ½æ¥æ”¶äº‹ä»¶,å¯èƒ½è¯¥Viewå½“å‰ä¸å¯è§                            if (!canViewReceivePointerEvents(child)                                    || !isTransformedTouchPointInView(x, y, child, null)) {                                ev.setTargetAccessibilityFocus(false);                                continue;                            }                            //åœ¨æ­¤è¯´æ˜è¯¥childå¯ä»¥æ¥å—äº‹ä»¶                            newTouchTarget = getTouchTarget(child);  //è¿”å›è¯¥Viewå¯¹åº”çš„TouchTarget                            if (newTouchTarget != null) {                                // Child is already receiving touch within its bounds.                                // Give it the new pointer in addition to the ones it is handling.                                newTouchTarget.pointerIdBits |= idBitsToAssign;                                break;                            }                            resetCancelNextUpFlag(child);                            //äº‹ä»¶åˆ†å‘ç»™child                            if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {                                // Child wants to receive touch within its bounds.                                mLastTouchDownTime = ev.getDownTime();                                if (preorderedList != null) {                                    // childIndex points into presorted list, find original index                                    for (int j = 0; j &lt; childrenCount; j++) {                                        if (children[childIndex] == mChildren[j]) {                                            mLastTouchDownIndex = j;                                            break;                                        }                                    }                                } else {                                    mLastTouchDownIndex = childIndex;                                }                                mLastTouchDownX = ev.getX();                                mLastTouchDownY = ev.getY();                                //æŠŠå¯ä»¥æ¥å—äº‹ä»¶çš„ViewåŠ åˆ°mFirstTouchTargetçš„è¡¨å¤´                                newTouchTarget = addTouchTarget(child, idBitsToAssign);                                alreadyDispatchedToNewTouchTarget = true;                                break;                            }                            // The accessibility focus didn't handle the event, so clear                            // the flag and do a normal dispatch to all children.                            ev.setTargetAccessibilityFocus(false);                        }                        if (preorderedList != null) preorderedList.clear();                    }                    if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) {                        // Did not find a child to receive the event.                        // Assign the pointer to the least recently added target.                        newTouchTarget = mFirstTouchTarget;                        while (newTouchTarget.next != null) {                            newTouchTarget = newTouchTarget.next;                        }                        newTouchTarget.pointerIdBits |= idBitsToAssign;                    }                }            }            // Dispatch to touch targets.            // è¯´æ˜æ²¡æœ‰childæ¥å¤„ç†è¯¥äº‹ä»¶,åˆ™æœ‰è¯¥ViewGroupè‡ªå·±å¤„ç†            if (mFirstTouchTarget == null) {                // No touch targets so treat this as an ordinary view.                // å†…éƒ¨è°ƒç”¨ --&gt; super.dispatchTouchEvent(transformedEvent);                // ç”±äºè¿™é‡Œsuperä¸ºView,view.dispatchTouchEvent(transformedEvent)ä¼šæŠŠäº‹ä»¶                // æ‹¿ç»™è‡ªå·±çš„onTouchEvent/onTouchå¤„ç†                handled = dispatchTransformedTouchEvent(ev, canceled, null,                        TouchTarget.ALL_POINTER_IDS);            } else {              //å¦åˆ™åˆ†å‘ç»™childå¤„ç†                // Dispatch to touch targets, excluding the new touch target if we already                // dispatched to it.  Cancel touch targets if necessary.                TouchTarget predecessor = null;                TouchTarget target = mFirstTouchTarget;                while (target != null) {                    final TouchTarget next = target.next;                    if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {                        handled = true;                    } else {                        final boolean cancelChild = resetCancelNextUpFlag(target.child)                                || intercepted;                        if (dispatchTransformedTouchEvent(ev, cancelChild,                                target.child, target.pointerIdBits)) {                            handled = true;                        }                        if (cancelChild) {                            if (predecessor == null) {                                mFirstTouchTarget = next;                            } else {                                predecessor.next = next;                            }                            target.recycle();                            target = next;                            continue;                        }                    }                    predecessor = target;                    target = next;                }            }            // Update list of touch targets for pointer up or cancel, if needed.            if (canceled                    || actionMasked == MotionEvent.ACTION_UP                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {                resetTouchState();            } else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) {                final int actionIndex = ev.getActionIndex();                final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex);                removePointersFromTouchTargets(idBitsToRemove);            }        }        if (!handled &amp;&amp; mInputEventConsistencyVerifier != null) {            mInputEventConsistencyVerifier.onUnhandledEvent(ev, 1);        }        return handled;    }</p>
]]></content>
    </entry>
</feed>